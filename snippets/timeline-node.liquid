{%- comment -%}
  Stellar Reverb â€” Timeline Node (safe Liquid)
  Inputs (fallback supported):
  - capsule (metaobject) OR
  - index, title, date, theme, teaser, lore, status, progress
{%- endcomment -%}

{%- liquid
  assign _index = index | default: forloop.index
  assign _title = title | default: capsule.capsule_title | default: capsule.title | default: 'UNKNOWN CAPSULE'
  assign _date  = date  | default: capsule.release_date | default: capsule.capsule_release_date | default: ''
  assign _theme = theme | default: capsule.capsule_theme_color | default: capsule.theme | default: 'cyan'
  assign _teaser = teaser | default: capsule.capsule_short_lore | default: capsule.teaser | default: ''

  assign _lore = lore | default: capsule.capsule_lore | default: capsule.lore | default: ''
  assign _progress = progress | default: capsule.progress | default: 0

  assign _status = status | default: capsule.status | default: capsule.capsule_status
  if _status == blank
    if _index > 8
      assign _status = 'incoming'
    else
      assign _status = 'released'
    endif
  endif
-%}

<div
  class="timeline-node theme-{{ _theme }} status-{{ _status }}"
  data-capsule="{{ _index }}"
  {% if _lore != blank %}data-lore="{{ _lore | escape }}"{% endif %}
>
  <div class="timeline-node__top">
    <div class="timeline-node__cap orbitron">CAPSULE {{ _index }}</div>
    {% if _date != blank %}<div class="timeline-node__date">{{ _date }}</div>{% endif %}
  </div>

  <h3 class="timeline-node__title orbitron">{{ _title }}</h3>

  {% if _teaser != blank %}
    <p class="timeline-node__teaser">{{ _teaser }}</p>
  {% endif %}

  <div class="timeline-node__meta">
    {% if _status == 'incoming' %}
      <div class="timeline-node__status">INCOMING</div>
      <div class="timeline-node__bar" aria-label="Progress">
        <span style="width: {{ _progress | at_most: 100 | at_least: 0 }}%"></span>
      </div>
    {% else %}
      <div class="timeline-node__status">RELEASED</div>
    {% endif %}
  </div>

  {% if _lore != blank %}
    <button class="timeline-node__btn orbitron" type="button">
      OPEN LORE
    </button>
  {% endif %}
</div>