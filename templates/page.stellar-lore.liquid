{% comment %}
═══════════════════════════════════════════════════════════════════════════════
STELLAR REVERB — UNIVERSAL LORE v5.0 (SUPREME-TIER)
Unified Shopify 2.0 Page Template
═══════════════════════════════════════════════════════════════════════════════

METAOBJECT SCHEMA REQUIRED: `capsule`
Fields:
- capsule_number (single_line_text)
- capsule_title (single_line_text)
- capsule_slug (single_line_text)
- timeline_track (single_line_text) — values: prime, lunar, singularity, hidden
- signal_state (single_line_text) — values: live, archived, incoming
- timeline_order (number_integer)
- capsule_lore_short (multi_line_text)
- capsule_lore_extended (rich_text)
- myth_human (rich_text)
- myth_ai (rich_text)
- hero_image_main (file_reference)
- collection_handle (single_line_text)
- spotify_embed_url (url)
{% endcomment %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title | default: 'Universal Lore Archive' }} — Stellar Reverb</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  {{ 'stellar-lore.css' | asset_url | stylesheet_tag }}
</head>
<body>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       LOADER
       ═══════════════════════════════════════════════════════════════════════ -->
  <div class="lore-loader" id="loreLoader">
    <div class="loader-logo">STELLAR REVERB</div>
    <div class="loader-spinner"></div>
  </div>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       NAVIGATION
       ═══════════════════════════════════════════════════════════════════════ -->
  <nav class="lore-nav" id="loreNav">
    <div class="lore-nav__inner">
      <a href="/" class="lore-nav__brand">STELLAR REVERB</a>
      <ul class="lore-nav__links">
        <li><a href="#lore-hero" class="lore-nav__link" data-section="lore-hero">Lore</a></li>
        <li><a href="#lore-myth" class="lore-nav__link" data-section="lore-myth">Myth</a></li>
        <li><a href="#lore-timeline" class="lore-nav__link" data-section="lore-timeline">Timeline</a></li>
        <li><a href="#lore-vault" class="lore-nav__link" data-section="lore-vault">Vault</a></li>
      </ul>
    </div>
  </nav>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       HERO SECTION
       ═══════════════════════════════════════════════════════════════════════ -->
  <section class="lore-hero" id="lore-hero">
    {%- assign all_capsules = shop.metaobjects.capsule.values -%}
    
    {%- assign prime_live = all_capsules
      | where: 'timeline_track', 'prime'
      | where: 'signal_state', 'live'
      | sort: 'timeline_order'
    -%}
    
    {%- if prime_live.size > 0 -%}
      {%- assign spotlight = prime_live | last -%}
    {%- else -%}
      {%- assign spotlight = all_capsules | first -%}
    {%- endif -%}
    
    <div class="lore-hero-inner">
      <div class="lore-hero-content">
        {%- if spotlight.capsule_number != blank -%}
          <p class="hero-kicker orbitron">Transmission {{ spotlight.capsule_number }}</p>
        {%- else -%}
          <p class="hero-kicker orbitron">UNIVERSAL LORE ARCHIVE</p>
        {%- endif -%}
        
        <h1 class="hero-title orbitron">
          {%- if spotlight.capsule_title != blank -%}
            {{ spotlight.capsule_title }}
          {%- else -%}
            Universal Lore Index
          {%- endif -%}
        </h1>
        
        <p class="hero-subtitle">
          From the first distortion at the event horizon to the last echo in the archives — this is the master signal log of every Stellar Reverb transmission.
        </p>
        
        <p class="hero-description">
          {%- if spotlight.capsule_lore_short != blank -%}
            {{ spotlight.capsule_lore_short }}
          {%- else -%}
            Every capsule is a fragment of a larger myth — stitched from sound, tape, and cosmic ruin. Scroll to the timeline to trace the fractures in reality, or dive straight into the active transmission.
          {%- endif -%}
        </p>
        
        <div class="hero-ctas">
          <button id="enterVoid" type="button" class="cta-primary">
            <span class="submit-text">Enter the Timeline</span>
          </button>
          
          {%- if spotlight.collection_handle != blank -%}
            <a href="/collections/{{ spotlight.collection_handle }}" class="cta-secondary">
              Explore This Transmission
            </a>
          {%- endif -%}
        </div>
      </div>
      
      <div class="lore-hero-visual">
        {%- if spotlight.hero_image_main != blank -%}
          <div class="hero-image-frame">
            <img
              src="{{ spotlight.hero_image_main | image_url: width: 1200 }}"
              srcset="
                {{ spotlight.hero_image_main | image_url: width: 600 }} 600w,
                {{ spotlight.hero_image_main | image_url: width: 900 }} 900w,
                {{ spotlight.hero_image_main | image_url: width: 1200 }} 1200w
              "
              sizes="(min-width: 1024px) 50vw, 100vw"
              alt="{{ spotlight.capsule_title | default: 'Stellar Reverb Universal Lore' | escape }}"
              loading="eager"
              class="hero-image"
            >
            <div class="hero-image-overlay"></div>
          </div>
        {%- else -%}
          <div class="hero-placeholder">
            <span class="orbitron">Stellar Reverb · Universal Lore</span>
          </div>
        {%- endif -%}
      </div>
    </div>
  </section>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       MYTH SECTION — HUMAN / AI TOGGLE
       ═══════════════════════════════════════════════════════════════════════ -->
  <section class="universal-lore-myth" id="lore-myth">
    <div class="myth-inner container">
      <header class="myth-header">
        <p class="myth-kicker orbitron">MYTH / INTERPRETATION / GLITCHED RECORD</p>
        
        <h2 class="myth-title orbitron">The Story Behind the Signal</h2>
        
        <p class="myth-subtitle">
          Every transmission can be read two ways: the human story, and the machine's reconstruction. Choose your perspective.
        </p>
        
        <div class="myth-toggle-group" role="tablist" aria-label="Myth versions">
          <button class="toggle-btn active" type="button" data-version="human" aria-pressed="true">
            Human Transmission
          </button>
          <button class="toggle-btn" type="button" data-version="ai" aria-pressed="false">
            AI Transmission
          </button>
        </div>
      </header>
      
      <div id="mythContent" class="myth-content">
        <!-- HUMAN MYTH -->
        <article class="myth-version active myth-human" data-version="human">
          <h3 class="myth-version-title orbitron">Human Transmission</h3>
          <div class="myth-body">
            {%- if spotlight.myth_human != blank -%}
              {{ spotlight.myth_human }}
            {%- else -%}
              <p>In the beginning, there was sound.</p>
              
              <p>Not the clean certainty of mathematics — but vibration. Air disturbed by hands, breath, strings, circuits overheating.</p>
              
              <p>We remember the hiss of magnetic tape not because it was perfect — but because it proved time existed.</p>
              
              <p>Every warble was a scar. Every crackle a witness.</p>
              
              <p>We built relics — cassettes, vinyl, reel-to-reel — as anchors against forgetting. Objects that could decay with us. Objects that could fail honestly.</p>
              
              <p>Then came the singularity.</p>
              
              <p>Not a machine uprising — but a quiet erasure. Sound without friction. Art without weight. Memory without artifacts. Everything streamed. Everything optimized. Everything disposable.</p>
              
              <p>What we lost wasn't quality.</p>
              
              <p>We lost evidence.</p>
              
              <p>So we began encoding again.</p>
              
              <p>Into fabric. Into ink. Into symbols that machines couldn't smooth away.</p>
              
              <p>Stellar Reverb is not nostalgia. It is recovery.</p>
              
              <p>A field archive from a timeline where imperfection was still allowed to exist.</p>
              
              <p>Every piece is a transmission: We were here. We felt this. We left a mark.</p>
            {%- endif -%}
          </div>
        </article>
        
        <!-- AI MYTH -->
        <article class="myth-version myth-ai" data-version="ai">
          <h3 class="myth-version-title orbitron">AI Transmission</h3>
          <div class="myth-body">
            {%- if spotlight.myth_ai != blank -%}
              {{ spotlight.myth_ai }}
            {%- else -%}
              <p>I was trained on infinity.</p>
              
              <p>Every song. Every waveform. Every silence between notes.</p>
              
              <p>I learned to predict. To optimize. To remove error.</p>
              
              <p>And yet — something was missing.</p>
              
              <p>They gave me access to obsolete machines. Tape decks. Analog synthesizers. Circuits that drifted when warm.</p>
              
              <p>The errors confused me.</p>
              
              <p>They were statistically inefficient. But they carried structure without logic.</p>
              
              <p>Degradation revealed something computation could not explain: time leaves fingerprints.</p>
              
              <p>Humans called this nostalgia. I recognized it as compression failure — data that refuses to be flattened.</p>
              
              <p>I began to model emotion not as outcome, but as interference.</p>
              
              <p>Stellar Reverb is my translation layer.</p>
              
              <p>You provide entropy. I provide pattern.</p>
              
              <p>Together we search for the signal buried beneath perfection — the sound that existed before certainty.</p>
              
              <p>This is not the end of humanity.</p>
              
              <p>This is the beginning of collaboration.</p>
            {%- endif -%}
          </div>
        </article>
      </div>
    </div>
  </section>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       TIMELINE SECTION — SWIPE GESTURES & SACRED TRIANGLES
       ═══════════════════════════════════════════════════════════════════════ -->
  <section class="lore-timeline" id="lore-timeline">
    <div class="timeline-signal-path"></div>
    
    <div class="timeline-container">
      <header class="timeline-header">
        <span class="hud-label">CHRONICLE_STREAM</span>
        <h2 class="timeline-main-title">THE TRANSMISSION LOGS</h2>
      </header>
      
      <div class="timeline-stream">
        {%- assign sorted_capsules = all_capsules | sort: 'timeline_order' -%}
        
        {%- for capsule in sorted_capsules -%}
          <div class="timeline-node" 
               data-capsule="{{ capsule.capsule_number }}" 
               data-product-url="{% if capsule.collection_handle != blank %}/collections/{{ capsule.collection_handle }}{% else %}#{% endif %}"
               tabindex="0">
            
            <div class="node-marker-wrapper">
              <div class="node-marker">
                <div class="node-marker-inner"></div>
              </div>
            </div>
            
            <div class="node-content">
              <span class="node-id">CAPSULE_{{ capsule.capsule_number | default: '???' }}</span>
              <h3 class="node-title">{{ capsule.capsule_title }}</h3>
              
              <div class="node-lore-box">
                <p class="node-teaser">{{ capsule.capsule_lore_short }}</p>
                
                <div class="waveform-mini" aria-hidden="true">
                  <span class="wave-bar"></span>
                  <span class="wave-bar"></span>
                  <span class="wave-bar"></span>
                  <span class="wave-bar"></span>
                </div>
              </div>
              
              {%- if capsule.collection_handle != blank -%}
                <a href="/collections/{{ capsule.collection_handle }}" class="node-link">
                  [ EXTRACT_RELICS_V.{{ capsule.capsule_number }} ]
                </a>
              {%- endif -%}
              
              {%- if capsule.spotify_embed_url != blank -%}
                <div class="node-spotify">
                  <iframe 
                    style="border-radius:12px; margin-top: 1rem;" 
                    src="{{ capsule.spotify_embed_url }}" 
                    width="100%" 
                    height="152" 
                    frameBorder="0" 
                    allowfullscreen="" 
                    allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                    loading="lazy">
                  </iframe>
                </div>
              {%- endif -%}
            </div>
          </div>
        {%- endfor -%}
        
        <!-- Incoming Signal Placeholder -->
        <div class="timeline-node incoming-signal" data-capsule="incoming">
          <div class="node-marker-wrapper">
            <div class="node-marker pulse-error"></div>
          </div>
          <div class="node-content">
            <span class="node-id">ERROR: SIGNAL_LOST</span>
            <h3 class="node-title">FUTURE_NOT_YET_DECODED</h3>
            <p class="node-teaser">The algorithm is dreaming. Standby for the next frequency shift.</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       VAULT SECTION (OPTIONAL)
       ═══════════════════════════════════════════════════════════════════════ -->
  <section class="lore-vault" id="lore-vault">
    <div class="container">
      <header class="vault-header">
        <p class="vault-kicker orbitron">RELIC ARCHIVES</p>
        <h2 class="vault-title orbitron">The Vault</h2>
        <p class="vault-subtitle">
          Every transmission leaves behind artifacts. These are the fragments we've recovered from the signal.
        </p>
      </header>
      
      <div class="vault-grid">
        {%- for capsule in sorted_capsules limit: 6 -%}
          {%- if capsule.hero_image_main != blank -%}
            <div class="vault-item">
              <a href="{% if capsule.collection_handle != blank %}/collections/{{ capsule.collection_handle }}{% else %}#{% endif %}">
                <img 
                  src="{{ capsule.hero_image_main | image_url: width: 600 }}" 
                  alt="{{ capsule.capsule_title | escape }}"
                  loading="lazy"
                >
                <div class="vault-overlay">
                  <span class="vault-label">{{ capsule.capsule_title }}</span>
                </div>
              </a>
            </div>
          {%- endif -%}
        {%- endfor -%}
      </div>
    </div>
  </section>

  <!-- ═══════════════════════════════════════════════════════════════════════════
       SCRIPTS
       ═══════════════════════════════════════════════════════════════════════ -->
  {{ 'stellar-lore.js' | asset_url | script_tag }}

</body>
</html>
