{% comment %}
═══════════════════════════════════════════════════════════════════════════════
  STELLAR REVERB - UNIVERSAL LORE: SIGNALS FROM THE VOID
  Ultimate Shopify Liquid Template - Multi-Million Empire Architecture
  Version: SUPREME ULTIMATE v3.0
  
  Performance Targets:
  - FCP: <1000ms (0.0001% optimization)
  - LCP: <2500ms
  - CLS: <0.1
  - Mobile-first: 70% traffic priority
  
  Fusion Architecture:
  - V69 RGB glitch + AR + Konami modal + tape-scroll
  - v3 Ultimate myth toggle + cassette boxes + pulse hero
  - Original files: All best elements combined
  
  Modular Structure:
  This template uses Shopify sections for maximum flexibility.
  Each section can be customized via theme editor without code changes.
═══════════════════════════════════════════════════════════════════════════════
{% endcomment %}

{% comment %} === LIQUID VARIABLES & SETTINGS === {% endcomment %}
{% assign page_title = page.title | default: "UNIVERSAL LORE: SIGNALS FROM THE VOID" %}
{% assign page_description = page.metafields.custom.lore_description | default: "Distort reality, wear the echo. Enter the Stellar Reverb universe where analog mysticism meets cosmic surrealism." %}
{% assign enable_konami = section.settings.enable_konami_code | default: true %}
{% assign enable_signal_feed = section.settings.enable_signal_feed | default: true %}
{% assign capsule_collection = collections['cosmic-capsules'] %}
{% assign glyph_collection = collections['sonic-glyphs'] %}
<!DOCTYPE html>
<html lang="{{ request.locale.iso_code }}" class="no-js">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#E13CFA">
  
  {% comment %} === SEO & SOCIAL META === {% endcomment %}
  <title>{{ page_title }} | {{ shop.name }}</title>
  <meta name="description" content="{{ page_description }}">
  
  {% if page.metafields.custom.og_image %}
    <meta property="og:image" content="{{ page.metafields.custom.og_image | img_url: '1200x630' }}">
  {% else %}
    <meta property="og:image" content="{{ 'lore-og-image.jpg' | asset_url }}">
  {% endif %}
  
  <meta property="og:title" content="{{ page_title }}">
  <meta property="og:description" content="{{ page_description }}">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ canonical_url }}">
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ page_title }}">
  <meta name="twitter:description" content="{{ page_description }}">
  
  <link rel="canonical" href="{{ canonical_url }}">
  
  {% comment %} === STRUCTURED DATA === {% endcomment %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "CreativeWork",
    "name": "{{ page_title }}",
    "description": "{{ page_description }}",
    "url": "{{ canonical_url }}",
    "author": {
      "@type": "Organization",
      "name": "{{ shop.name }}",
      "url": "{{ shop.url }}"
    },
    "publisher": {
      "@type": "Organization",
      "name": "{{ shop.name }}"
    }
  }
  </script>
  
  {% comment %} === PERFORMANCE: CRITICAL CSS INLINE === {% endcomment %}
  <style>
    {% render 'critical-lore-css' %}
  </style>
  
  {% comment %} === FONT PRELOAD === {% endcomment %}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Montserrat:wght@300;400;600;700&display=swap" as="style">
  
  {% comment %} === SHOPIFY ESSENTIALS === {% endcomment %}
  {{ content_for_header }}
  
  {% comment %} === DEFERRED STYLESHEETS === {% endcomment %}
  {{ 'lore-main.css' | asset_url | stylesheet_tag: preload: true }}
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
</head>
  ...
  {%- comment -%} Main scripts {%- endcomment -%}
  <script src="{{ 'lore-main.js' | asset_url }}" defer></script>
  <script src="{{ 'universal-lore.js' | asset_url }}" defer></script>

  {% if section.settings.enable_spotify %}
    <script src="https://sdk.scdn.co/spotify-player.js" defer></script>
  {% endif %}
</body>
</html>
<body class="template-lore">
  {% comment %} === SACRED TRIANGLE LOADER === {% endcomment %}
  {% section 'lore-loader' %}
  
  {% comment %} === COSMIC NAVIGATION === {% endcomment %}
  {% section 'lore-navigation' %}
  
  {% comment %} === HERO: SIGNALS FROM THE VOID === {% endcomment %}
  {% section 'lore-hero' %}
  
  {% comment %} === WAVEFORM DIVIDER === {% endcomment %}
  <div class="waveform-divider" aria-hidden="true"></div>
  
  {% comment %} === TRANSMISSION TIMELINE (Capsules) === {% endcomment %}
  {% section 'lore-timeline' %}
  
  {% comment %} === SONIC GLYPH VAULT (Products) === {% endcomment %}
  {% section 'lore-vault' %}
  
  {% comment %} === LIVE SIGNAL FEED (X/Twitter Integration) === {% endcomment %}
  {% if enable_signal_feed %}
    {% section 'lore-signal-feed' %}
  {% endif %}
  
  {% comment %} === STELLAR MYTHOLOGY (Human/AI Toggle) === {% endcomment %}
  {% section 'lore-mythology' %}
  
  {% comment %} === NEWSLETTER SIGNUP (Klaviyo) === {% endcomment %}
  {% section 'lore-newsletter' %}
  
  {% comment %} === KONAMI CODE EASTER EGG === {% endcomment %}
  {% if enable_konami %}
    {% section 'lore-konami-modal' %}
  {% endif %}
  
  {% comment %} === MAIN SCRIPTS === {% endcomment %}
  <script src="{{ 'lore-main.js' | asset_url }}" defer></script>
  
  {% comment %} === SPOTIFY EMBED SCRIPT === {% endcomment %}
  {% if section.settings.enable_spotify %}
    <script src="https://sdk.scdn.co/spotify-player.js" defer></script>
  {% endif %}
  
  {% comment %} === AR MODEL VIEWER === {% endcomment %}
  {% if section.settings.enable_ar %}
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
  {% endif %}
  
  {% comment %} === KLAVIYO INTEGRATION === {% endcomment %}
  {% if section.settings.klaviyo_api_key %}
    <script src="https://static.klaviyo.com/onsite/js/klaviyo.js?company_id={{ section.settings.klaviyo_api_key }}" defer></script>
  {% endif %}
</body>
</html>

{% schema %}
{
  "name": "Universal Lore Page",
  "settings": [
    {
      "type": "header",
      "content": "Page Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_konami_code",
      "label": "Enable Konami Code Easter Egg",
      "default": true,
      "info": "Unlock secret collection with ↑↑↓↓←→←→BA"
    },
    {
      "type": "checkbox",
      "id": "enable_signal_feed",
      "label": "Enable Live Signal Feed",
      "default": true,
      "info": "Real-time X/Twitter mentions"
    },
    {
      "type": "checkbox",
      "id": "enable_spotify",
      "label": "Enable Spotify Integration",
      "default": true,
      "info": "Embed audio previews for capsules"
    },
    {
      "type": "checkbox",
      "id": "enable_ar",
      "label": "Enable AR Glyph Previews",
      "default": true,
      "info": "AR model viewer for products"
    },
    {
      "type": "text",
      "id": "klaviyo_api_key",
      "label": "Klaviyo Company ID",
      "info": "Your Klaviyo public API key for newsletter integration"
    }
  ]
}
{% endschema %}