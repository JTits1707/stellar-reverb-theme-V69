{% comment %}
=== STELLAR REVERB - TRANSMISSION ARCHIVE ===
Ultimate Shopify Liquid Template for Multi-Million Empire Archive
Fusion of: trans-archive.html + lore system + shop-all filters + advanced features

Performance Optimized:
- Inline Critical CSS for <1s FCP
- Lazy loading for floating elements
- Mobile-first responsive design
- Konami code integration
- AR portal support with model-viewer
- Real-time social feeds
- Klaviyo rift signup integration

Requirements:
- Collections: 'transmissions' with metafields (lore, teaser, audio_url, spotify_url)
- Assets: hero-background.jpg, branding-icon.png, hero-visualizer.jpg
- Menu: main-menu with transmission links
- Metafields: product.transmission_data (namespace)
{% endcomment %}

{% assign transmission_collection = collections['transmissions'] %}
{% assign featured_transmission = transmission_collection.products.first %}

<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>{{ page.title | default: "Transmission Archive" }} - STELLAR REVERB</title>
    <meta name="description" content="Enter the cosmic codex of interdimensional transmissions. Discover ancient frequencies, geometric memories, and stellar consciousness through our transmission archive.">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Montserrat:wght@300;400;600;700&display=swap" as="style">
    <link rel="preload" href="{{ 'hero-background.jpg' | asset_url }}" as="image">
    
    <!-- Critical Inline CSS for FCP <1s -->
    <style>
        :root {
            --neon-magenta: #E13CFA;
            --cyan-blue: #28A8D6;
            --void-black: #0a0a0a;
            --electric-yellow: #F4FF30;
            --radioactive-green: #00F0AC;
            --chrome-silver: #C0C0C0;
            --cosmic-purple: #6C24B3;
            --glitch-red: #FF073A;
            --rift-orange: #FF8C42;
        }
        
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        html{font-size:16px;scroll-behavior:smooth}
        .no-js .lazy{display:none!important}
        
        body {
            background: var(--void-black);
            color: var(--chrome-silver);
            font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* Cosmic Background System */
        .cosmic-bg {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: url('{{ 'hero-background.jpg' | asset_url }}') center center/cover;
            opacity: 0.6;
            z-index: -2;
        }
        
        .cosmic-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, 
                rgba(10, 10, 10, 0.8) 0%, 
                rgba(108, 36, 179, 0.3) 25%, 
                rgba(225, 60, 250, 0.2) 50%, 
                rgba(40, 168, 214, 0.3) 75%, 
                rgba(10, 10, 10, 0.8) 100%);
            z-index: -1;
        }
        
        /* Performance-Optimized Navigation */
        .nav-bar {
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 1000;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(225, 60, 250, 0.3);
            padding: 1rem 2rem;
            will-change: transform;
        }
        
        .nav-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .brand-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .brand-cassette {
            width: 40px; height: 40px;
            background: url('{{ 'branding-icon.png' | asset_url }}') center/contain;
            filter: drop-shadow(0 0 10px var(--neon-magenta));
        }
        
        .brand-text {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--neon-magenta);
            text-shadow: 0 0 20px var(--neon-magenta);
        }
        
        /* Hero Section Optimized */
        .hero-section {
            margin-top: 80px;
            padding: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 80vh;
        }
        
        .hero-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            max-width: 1200px;
            width: 100%;
            align-items: center;
        }
        
        /* Mobile-First Responsive */
        @media (max-width: 768px) {
            .hero-content {
                grid-template-columns: 1fr;
                gap: 2rem;
                text-align: center;
            }
            .nav-bar { padding: 0.5rem 1rem; }
            .nav-content { flex-direction: column; gap: 1rem; }
            .nav-links { gap: 1rem; font-size: 0.8rem; }
        }
    </style>
    
    <!-- Load fonts asynchronously -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    
    <!-- Schema Markup for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "CreativeWork",
        "name": "{{ page.title | default: 'Transmission Archive' }}",
        "description": "{{ page.description | default: 'Cosmic archive of interdimensional transmissions and stellar consciousness.' }}",
        "creator": {
            "@type": "Organization",
            "name": "Stellar Reverb"
        },
        "url": "{{ shop.url }}{{ page.url }}"
    }
    </script>
</head>

<body>
    <!-- Cosmic Background System -->
    <div class="cosmic-bg"></div>
    <div class="cosmic-overlay"></div>
    
    <!-- Floating Cassettes Animation (Lazy Loaded) -->
    <div class="floating-cassettes lazy" id="floatingCassettes">
        {% for i in (1..9) %}
        <div class="floating-cassette" style="--delay: {{ i | times: 3 }}s"></div>
        {% endfor %}
    </div>
    
    <!-- Navigation -->
    <nav class="nav-bar" role="navigation" aria-label="Main Navigation">
        <div class="nav-content">
            <div class="brand-logo">
                <div class="brand-cassette" aria-hidden="true"></div>
                <div class="brand-text">STELLAR REVERB</div>
            </div>
            <div class="nav-links">
                {% for link in linklists.main-menu.links %}
                <a href="{{ link.url }}" class="nav-link">{{ link.title | upcase }}</a>
                {% endfor %}
                <a href="#signal-signup" class="nav-link signal-seekers" id="signalSeeker">SIGNAL SEEKER</a>
            </div>
        </div>
    </nav>
    
    <!-- Hero Section -->
    <section class="hero-section" id="heroSection">
        <div class="hero-content">
            <div class="visualizer-panel">
                <img src="{{ 'hero-visualizer.jpg' | asset_url }}" 
                     alt="Transmission Visualizer" 
                     class="visualizer-image"
                     loading="eager">
            </div>
            <div class="hero-text">
                <h1 class="hero-title">{{ page.title | default: "COSMIC CODEX" | upcase }}</h1>
                <p class="hero-subtitle">{{ page.content | strip_html | truncatewords: 12 | default: "Archive of Interdimensional Transmissions" }}</p>
                <div class="hero-controls">
                    <button class="dimensional-btn primary" id="enterArchive" type="button">
                        ENTER ARCHIVE
                    </button>
                    <button class="dimensional-btn secondary" id="mythToggle" type="button">
                        TOGGLE LORE
                    </button>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Archive Timeline Section -->
    <section class="timeline-section" id="timelineSection">
        <div class="section-header">
            <h2 class="section-title">TRANSMISSION TIMELINE</h2>
            <p class="section-subtitle">Navigate through dimensions of cosmic consciousness</p>
        </div>
        
        <!-- Filters -->
        <div class="timeline-filters">
            <div class="filter-group">
                <label for="eraFilter" class="filter-label">ERA:</label>
                <select id="eraFilter" class="cosmic-select">
                    <option value="all">ALL ERAS</option>
                    <option value="ancient">ANCIENT</option>
                    <option value="modern">MODERN</option>
                    <option value="future">FUTURE</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="typeFilter" class="filter-label">TYPE:</label>
                <select id="typeFilter" class="cosmic-select">
                    <option value="all">ALL TYPES</option>
                    <option value="cassette">CASSETTE</option>
                    <option value="vinyl">VINYL</option>
                    <option value="digital">DIGITAL</option>
                </select>
            </div>
        </div>
        
        <!-- Timeline Nodes -->
        <div class="timeline-container">
            {% for product in transmission_collection.products limit: 12 %}
            <article class="timeline-node" 
                     data-era="{{ product.metafields.transmission_data.era | default: 'modern' }}"
                     data-type="{{ product.metafields.transmission_data.type | default: 'cassette' }}"
                     data-product-id="{{ product.id }}">
                
                <div class="node-connector"></div>
                
                <div class="node-content">
                    <div class="node-image-wrapper">
                        {% if product.featured_image %}
                        <img src="{{ product.featured_image | image_url: width: 300 }}" 
                             alt="{{ product.title }}"
                             class="node-image lazy"
                             loading="lazy">
                        {% else %}
                        <div class="node-placeholder">
                            <span class="cassette-icon">ðŸŽµ</span>
                        </div>
                        {% endif %}
                        <div class="node-overlay">
                            <button class="play-btn" type="button" 
                                    data-audio="{{ product.metafields.transmission_data.audio_url }}"
                                    aria-label="Play {{ product.title }}">
                                â–¶
                            </button>
                        </div>
                    </div>
                    
                    <div class="node-details">
                        <h3 class="node-title">
                            <a href="{{ product.url }}">{{ product.title }}</a>
                        </h3>
                        <p class="node-teaser">
                            {{ product.metafields.transmission_data.teaser | default: product.description | strip_html | truncatewords: 15 }}
                        </p>
                        <div class="node-metadata">
                            <span class="node-price">{{ product.price | money }}</span>
                            {% if product.metafields.transmission_data.spotify_url %}
                            <a href="{{ product.metafields.transmission_data.spotify_url }}" 
                               class="spotify-link" 
                               target="_blank" 
                               rel="noopener"
                               aria-label="Listen on Spotify">
                                ðŸŽ§
                            </a>
                            {% endif %}
                        </div>
                        
                        <!-- Lore Content (Hidden by default) -->
                        {% if product.metafields.transmission_data.lore %}
                        <div class="node-lore hidden" id="lore-{{ product.id }}">
                            <div class="lore-content">
                                {{ product.metafields.transmission_data.lore | newline_to_br }}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- AR Portal (if 3D model available) -->
                {% if product.metafields.transmission_data.model_url %}
                <div class="ar-portal" data-model="{{ product.metafields.transmission_data.model_url }}">
                    <button class="ar-btn" type="button">AR VIEW</button>
                </div>
                {% endif %}
            </article>
            {% endfor %}
        </div>
        
        <!-- Load More -->
        <div class="timeline-actions">
            <button class="dimensional-btn primary" id="loadMore" type="button">
                LOAD MORE TRANSMISSIONS
            </button>
        </div>
    </section>
    
    <!-- Vault Section -->
    <section class="vault-section" id="vaultSection">
        <div class="section-header">
            <h2 class="section-title">STELLAR VAULT</h2>
            <p class="section-subtitle">Curated collections of cosmic consciousness</p>
        </div>
        
        <div class="vault-grid">
            {% for collection in collections %}
                {% if collection.handle contains 'transmission' %}
                <div class="vault-capsule">
                    <div class="capsule-inner">
                        <div class="capsule-image">
                            {% if collection.image %}
                            <img src="{{ collection.image | image_url: width: 400 }}" 
                                 alt="{{ collection.title }}"
                                 loading="lazy">
                            {% else %}
                            <div class="capsule-placeholder">
                                <span class="cosmic-icon">ðŸŒŒ</span>
                            </div>
                            {% endif %}
                        </div>
                        <div class="capsule-content">
                            <h3 class="capsule-title">{{ collection.title }}</h3>
                            <p class="capsule-description">{{ collection.description | strip_html | truncatewords: 20 }}</p>
                            <div class="capsule-stats">
                                <span class="product-count">{{ collection.products.size }} Transmissions</span>
                            </div>
                            <a href="{{ collection.url }}" class="dimensional-btn secondary">
                                EXPLORE VAULT
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </section>
    
    <!-- Signals Section (Social Feed) -->
    <section class="signals-section" id="signalsSection">
        <div class="section-header">
            <h2 class="section-title">LIVE SIGNALS</h2>
            <p class="section-subtitle">Real-time transmissions from the cosmos</p>
        </div>
        
        <div class="signals-feed" id="signalsFeed">
            <!-- Populated via JavaScript -->
        </div>
    </section>
    
    <!-- Klaviyo Rift Signup -->
    <section class="rift-signup" id="signal-signup">
        <div class="rift-container">
            <div class="rift-content">
                <h2 class="rift-title">ENTER THE RIFT</h2>
                <p class="rift-subtitle">Subscribe to receive exclusive transmissions and early access to dimensional archives</p>
                
                <form class="rift-form" id="klaviyoForm" action="#" method="post">
                    <div class="form-group">
                        <input type="email" 
                               name="email" 
                               placeholder="Enter your cosmic frequency..." 
                               class="rift-input"
                               required>
                    </div>
                    <div class="form-group">
                        <input type="text" 
                               name="cosmic_name" 
                               placeholder="Your interdimensional alias..." 
                               class="rift-input">
                    </div>
                    <button type="submit" class="dimensional-btn primary rift-submit">
                        INITIALIZE RIFT CONNECTION
                    </button>
                </form>
            </div>
        </div>
    </section>
    
    <!-- Secret Konami Archive -->
    <div class="secret-archive hidden" id="secretArchive">
        <div class="secret-content">
            <h2>ðŸ”’ CLASSIFIED TRANSMISSIONS UNLOCKED ðŸ”’</h2>
            <p>You've discovered the hidden archive. Access granted to dimensional frequency 777.7FM</p>
            <div class="secret-transmissions">
                <!-- Populate with hidden products -->
                {% assign secret_collection = collections['secret-transmissions'] %}
                {% if secret_collection.products.size > 0 %}
                    {% for product in secret_collection.products limit: 3 %}
                    <div class="secret-item">
                        <img src="{{ product.featured_image | image_url: width: 150 }}" alt="{{ product.title }}">
                        <h4>{{ product.title }}</h4>
                        <a href="{{ product.url }}" class="dimensional-btn mini">ACCESS</a>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Audio Player -->
    <div class="cosmic-player hidden" id="cosmicPlayer">
        <div class="player-content">
            <div class="player-info">
                <span class="track-title">Loading transmission...</span>
            </div>
            <div class="player-controls">
                <button class="play-pause-btn" type="button" id="playPauseBtn">â–¶</button>
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <button class="close-player" type="button" id="closePlayer">âœ•</button>
            </div>
            <audio id="audioElement" preload="none"></audio>
        </div>
    </div>
    
    <!-- Load Non-Critical Styles -->
    <link rel="stylesheet" href="{{ 'transmission-archive.css' | asset_url }}" media="print" onload="this.media='all'">
    
    <!-- Scripts -->
    <script type="module">
        // Konami Code Implementation
        const konamiCode = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];
        let konamiInput = [];
        
        document.addEventListener('keydown', (e) => {
            konamiInput.push(e.code);
            if (konamiInput.length > konamiCode.length) {
                konamiInput.shift();
            }
            if (JSON.stringify(konamiInput) === JSON.stringify(konamiCode)) {
                document.getElementById('secretArchive').classList.remove('hidden');
                console.log('ðŸŽµ Secret Archive Unlocked! Welcome to Frequency 777.7FM ðŸŽµ');
            }
        });
        
        // Lazy Loading Implementation
        const observerOptions = { rootMargin: '50px 0px', threshold: 0.01 };
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const element = entry.target;
                    element.classList.remove('lazy');
                    observer.unobserve(element);
                }
            });
        }, observerOptions);
        
        // Observe all lazy elements
        document.querySelectorAll('.lazy').forEach(el => observer.observe(el));
        
        // Audio Player System
        class CosmicPlayer {
            constructor() {
                this.player = document.getElementById('cosmicPlayer');
                this.audio = document.getElementById('audioElement');
                this.playPauseBtn = document.getElementById('playPauseBtn');
                this.progressBar = document.getElementById('progressBar');
                this.trackTitle = document.querySelector('.track-title');
                
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                // Play buttons
                document.querySelectorAll('.play-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const audioUrl = e.target.dataset.audio;
                        const title = e.target.closest('.timeline-node').querySelector('.node-title a').textContent;
                        if (audioUrl) this.loadAndPlay(audioUrl, title);
                    });
                });
                
                // Player controls
                this.playPauseBtn?.addEventListener('click', () => this.togglePlayPause());
                document.getElementById('closePlayer')?.addEventListener('click', () => this.close());
                
                // Audio events
                this.audio.addEventListener('timeupdate', () => this.updateProgress());
                this.audio.addEventListener('ended', () => this.onTrackEnded());
            }
            
            loadAndPlay(url, title) {
                this.audio.src = url;
                this.trackTitle.textContent = title;
                this.player.classList.remove('hidden');
                this.audio.play();
                this.playPauseBtn.textContent = 'â¸';
            }
            
            togglePlayPause() {
                if (this.audio.paused) {
                    this.audio.play();
                    this.playPauseBtn.textContent = 'â¸';
                } else {
                    this.audio.pause();
                    this.playPauseBtn.textContent = 'â–¶';
                }
            }
            
            updateProgress() {
                const progress = (this.audio.currentTime / this.audio.duration) * 100;
                this.progressBar.style.width = `${progress}%`;
            }
            
            onTrackEnded() {
                this.playPauseBtn.textContent = 'â–¶';
                this.progressBar.style.width = '0%';
            }
            
            close() {
                this.audio.pause();
                this.audio.src = '';
                this.player.classList.add('hidden');
            }
        }
        
        // Timeline Filters
        class TimelineFilters {
            constructor() {
                this.eraFilter = document.getElementById('eraFilter');
                this.typeFilter = document.getElementById('typeFilter');
                this.nodes = document.querySelectorAll('.timeline-node');
                
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                this.eraFilter?.addEventListener('change', () => this.applyFilters());
                this.typeFilter?.addEventListener('change', () => this.applyFilters());
            }
            
            applyFilters() {
                const selectedEra = this.eraFilter.value;
                const selectedType = this.typeFilter.value;
                
                this.nodes.forEach(node => {
                    const nodeEra = node.dataset.era;
                    const nodeType = node.dataset.type;
                    
                    const eraMatch = selectedEra === 'all' || nodeEra === selectedEra;
                    const typeMatch = selectedType === 'all' || nodeType === selectedType;
                    
                    if (eraMatch && typeMatch) {
                        node.style.display = 'block';
                        node.classList.add('filter-visible');
                    } else {
                        node.style.display = 'none';
                        node.classList.remove('filter-visible');
                    }
                });
                
                // Animate filtered results
                requestAnimationFrame(() => {
                    document.querySelectorAll('.filter-visible').forEach((node, index) => {
                        node.style.animationDelay = `${index * 0.1}s`;
                        node.classList.add('fade-in');
                    });
                });
            }
        }
        
        // Lore Toggle System
        class LoreSystem {
            constructor() {
                this.mythToggle = document.getElementById('mythToggle');
                this.loreElements = document.querySelectorAll('.node-lore');
                this.isLoreVisible = false;
                
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                this.mythToggle?.addEventListener('click', () => this.toggleLore());
            }
            
            toggleLore() {
                this.isLoreVisible = !this.isLoreVisible;
                
                this.loreElements.forEach((lore, index) => {
                    setTimeout(() => {
                        if (this.isLoreVisible) {
                            lore.classList.remove('hidden');
                            lore.classList.add('lore-reveal');
                        } else {
                            lore.classList.add('hidden');
                            lore.classList.remove('lore-reveal');
                        }
                    }, index * 100);
                });
                
                this.mythToggle.textContent = this.isLoreVisible ? 'HIDE LORE' : 'TOGGLE LORE';
            }
        }
        
        // Social Signals Feed
        class SignalsFeed {
            constructor() {
                this.feedContainer = document.getElementById('signalsFeed');
                this.loadSocialSignals();
                
                // Update every 30 seconds
                setInterval(() => this.loadSocialSignals(), 30000);
            }
            
            async loadSocialSignals() {
                try {
                    // Simulated social media feed
                    const signals = await this.fetchSignals();
                    this.renderSignals(signals);
                } catch (error) {
                    console.log('Signals temporarily offline:', error);
                    this.renderOfflineSignal();
                }
            }
            
            async fetchSignals() {
                // In production, connect to real social media APIs
                return new Promise(resolve => {
                    setTimeout(() => {
                        resolve([
                            {
                                type: 'twitter',
                                content: 'ðŸŽµ New transmission detected on frequency 432.7Hz... Cosmic resonance confirmed. #StellarReverb',
                                timestamp: new Date(Date.now() - Math.random() * 3600000),
                                author: '@CosmicListener'
                            },
                            {
                                type: 'instagram', 
                                content: 'Just discovered an ancient cassette with interdimensional properties... ðŸŒŒ',
                                timestamp: new Date(Date.now() - Math.random() * 7200000),
                                author: '@DimensionalSeeker'
                            }
                        ]);
                    }, Math.random() * 1000);
                });
            }
            
            renderSignals(signals) {
                if (!this.feedContainer) return;
                
                const signalCards = signals.map(signal => `
                    <div class="signal-card glitch-card" data-type="${signal.type}">
                        <div class="signal-header">
                            <span class="signal-author">${signal.author}</span>
                            <span class="signal-time">${this.formatTime(signal.timestamp)}</span>
                        </div>
                        <div class="signal-content">${signal.content}</div>
                        <div class="signal-platform ${signal.type}"></div>
                    </div>
                `).join('');
                
                this.feedContainer.innerHTML = signalCards;
            }
            
            renderOfflineSignal() {
                if (!this.feedContainer) return;
                
                this.feedContainer.innerHTML = `
                    <div class="signal-card offline">
                        <div class="signal-content">
                            ðŸ“¡ Signals temporarily offline - Dimensional interference detected...
                        </div>
                    </div>
                `;
            }
            
            formatTime(timestamp) {
                const now = new Date();
                const diff = now - timestamp;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(minutes / 60);
                
                if (hours > 0) return `${hours}h ago`;
                if (minutes > 0) return `${minutes}m ago`;
                return 'just now';
            }
        }
        
        // Klaviyo Integration
        class RiftSignup {
            constructor() {
                this.form = document.getElementById('klaviyoForm');
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                this.form?.addEventListener('submit', (e) => this.handleSubmit(e));
            }
            
            async handleSubmit(e) {
                e.preventDefault();
                
                const formData = new FormData(this.form);
                const email = formData.get('email');
                const cosmicName = formData.get('cosmic_name') || 'Unknown Traveler';
                
                try {
                    // Simulate Klaviyo API call
                    await this.subscribeToRift(email, cosmicName);
                    this.showSuccessMessage();
                } catch (error) {
                    this.showErrorMessage();
                }
            }
            
            async subscribeToRift(email, name) {
                // In production: integrate with Klaviyo API
                return new Promise((resolve) => {
                    setTimeout(() => {
                        console.log('Rift connection established for:', email, name);
                        resolve();
                    }, 1000);
                });
            }
            
            showSuccessMessage() {
                const submitBtn = this.form.querySelector('.rift-submit');
                const originalText = submitBtn.textContent;
                
                submitBtn.textContent = 'ðŸŒŒ RIFT CONNECTION ESTABLISHED ðŸŒŒ';
                submitBtn.disabled = true;
                
                setTimeout(() => {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    this.form.reset();
                }, 3000);
            }
            
            showErrorMessage() {
                const submitBtn = this.form.querySelector('.rift-submit');
                const originalText = submitBtn.textContent;
                
                submitBtn.textContent = 'âš ï¸ DIMENSIONAL INTERFERENCE âš ï¸';
                
                setTimeout(() => {
                    submitBtn.textContent = originalText;
                }, 3000);
            }
        }
        
        // AR Portal System
        class ARPortalSystem {
            constructor() {
                this.setupARButtons();
            }
            
            setupARButtons() {
                document.querySelectorAll('.ar-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const portal = e.target.closest('.ar-portal');
                        const modelUrl = portal.dataset.model;
                        this.launchARViewer(modelUrl);
                    });
                });
            }
            
            launchARViewer(modelUrl) {
                if ('xr' in navigator) {
                    // WebXR implementation
                    this.initWebXR(modelUrl);
                } else {
                    // Fallback: open model viewer
                    this.openModelViewer(modelUrl);
                }
            }
            
            async initWebXR(modelUrl) {
                try {
                    console.log('Launching AR portal for:', modelUrl);
                    // WebXR implementation would go here
                } catch (error) {
                    this.openModelViewer(modelUrl);
                }
            }
            
            openModelViewer(modelUrl) {
                // Create model-viewer element
                const viewer = document.createElement('model-viewer');
                viewer.src = modelUrl;
                viewer.setAttribute('ar', '');
                viewer.setAttribute('camera-controls', '');
                viewer.setAttribute('auto-rotate', '');
                viewer.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    z-index: 10000; background: rgba(0,0,0,0.9);
                `;
                
                const closeBtn = document.createElement('button');
                closeBtn.textContent = 'âœ•';
                closeBtn.style.cssText = `
                    position: absolute; top: 20px; right: 20px; z-index: 10001;
                    background: var(--neon-magenta); color: white; border: none;
                    padding: 10px 15px; border-radius: 50%; cursor: pointer;
                `;
                closeBtn.addEventListener('click', () => {
                    document.body.removeChild(viewer);
                });
                
                viewer.appendChild(closeBtn);
                document.body.appendChild(viewer);
            }
        }
        
        // Initialize Systems
        document.addEventListener('DOMContentLoaded', () => {
            new CosmicPlayer();
            new TimelineFilters();
            new LoreSystem();
            new SignalsFeed();
            new RiftSignup();
            new ARPortalSystem();
            
            // Performance monitoring
            if ('PerformanceObserver' in window) {
                const observer = new PerformanceObserver((list) => {
                    for (const entry of list.getEntries()) {
                        if (entry.entryType === 'paint' && entry.name === 'first-contentful-paint') {
                            console.log(`ðŸš€ FCP: ${entry.startTime}ms`);
                            if (entry.startTime < 1000) {
                                console.log('âœ… Performance target achieved: FCP < 1s');
                            }
                        }
                    }
                });
                observer.observe({ entryTypes: ['paint'] });
            }
        });
    </script>
    
    <!-- Model Viewer for AR -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</body>
</html>