{% comment %}
Lore Vault – glyph grid
Relies on:
- .glyph-item for JS animation
- .glitch-particles container for particle system
Metafields:
- product.metafields.lore.glyph_type
- product.metafields.lore.description
{% endcomment %}

{% assign glyph_collection = collections[section.settings.glyph_collection] %}

<section
  class="vault-section section-{{ section.id }}"
  data-section-id="{{ section.id }}"
  data-section-type="lore-vault"
>
  <div class="container">
    <h2 class="section-title orbitron mb-2">
      {{ section.settings.section_title | default: 'THE GLYPH VAULT' }}
    </h2>

    <p class="vault-description mb-4 text-sm text-muted">
      {{ section.settings.section_description | default: 'Each glyph is a key to a different dimension of the Stellar Reverb universe. Hover to reveal its meaning; click to access its associated capsule.' }}
    </p>

    <div class="glyph-grid" id="glyphGrid">
      {% for product in glyph_collection.products limit: 6 %}
        {% assign glyph_type = product.metafields.lore.glyph_type | default: 'echo-prism' %}
        {% assign glyph_description = product.metafields.lore.description | default: product.description | strip_html | truncate: 60 %}

        <div
          class="glyph-item"
          data-glyph="{{ glyph_type }}"
          data-product-id="{{ product.variants.first.id }}"
          tabindex="0"
          role="button"
          aria-label="Glyph: {{ product.title }}"
        >
          <div class="glyph-visual" aria-hidden="true">
            {% if product.featured_image %}
              <img
                src="{{ product.featured_image | img_url: '300x300' }}"
                alt="{{ product.title }}"
                loading="lazy"
                class="glyph-image"
              >
            {% else %}
              <div class="glyph-shape {{ glyph_type }}"></div>
            {% endif %}
          </div>

          <div class="glyph-info">
            <h3 class="orbitron text-sm mb-1">
              {{ product.title | upcase }}
            </h3>
            <p class="text-sm mb-2">
              {{ glyph_description }}
            </p>

            {% if product.available %}
              <div class="glyph-price text-sm flex items-baseline gap-2">
                <span class="price">
                  {{ product.price | money }}
                </span>
                {% if product.compare_at_price > product.price %}
                  <span class="compare-price text-xs">
                    {{ product.compare_at_price | money }}
                  </span>
                {% endif %}
              </div>
            {% else %}
              <p class="text-xs text-muted">Archived glyph · Sold out</p>
            {% endif %}
          </div>

          <div class="glitch-particles" aria-hidden="true"></div>
        </div>
      {% endfor %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Lore Vault",
  "settings": [
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "THE GLYPH VAULT"
    },
    {
      "type": "textarea",
      "id": "section_description",
      "label": "Section Description",
      "default": "Each glyph is a key to a different dimension of the Stellar Reverb universe."
    },
    {
      "type": "collection",
      "id": "glyph_collection",
      "label": "Glyph Collection"
    }
  ],
  "presets": [
    {
      "name": "Lore Vault",
      "category": "Stellar Reverb"
    }
  ]
}
{% endschema %}