{% comment %}
  ═══════════════════════════════════════════════════════════
  STELLAR REVERB - NAVIGATION MATRIX SECTION
  ═══════════════════════════════════════════════════════════

  Purpose: Grid-based navigation with icon badges
  Features:
    - Customizable icon grid
    - Hover effects with glow
    - Flexible 2-6 column layout
    - Icon + text combinations
    - Theme color variations

  Usage: Add to homepage for quick navigation to key pages

  ═══════════════════════════════════════════════════════════
{% endcomment %}

{% liquid
  assign grid_columns = section.settings.grid_columns | default: 4
  assign show_heading = section.settings.show_heading | default: true
%}
{% liquid
  assign grid_columns = section.settings.grid_columns | default: 4
  assign show_heading = section.settings.show_heading | default: true
%}

<section 
  class="navigation-matrix" 
  data-section-id="{{ section.id }}"
  data-section-type="navigation-matrix"
  style="--grid-columns: {{ grid_columns }};"
>
  
  <div class="container">
    
    {%- comment -%} Section Header {%- endcomment -%}
    {% if show_heading %}
      <div class="matrix-header">
        <h2 class="matrix-heading">
          {{ section.settings.heading | default: 'NAVIGATE THE SIGNAL' }}
        </h2>
        {% if section.settings.subheading != blank %}
          <p class="matrix-subheading">{{ section.settings.subheading }}</p>
        {% endif %}
      </div>
    {% endif %}
    
    {%- comment -%} Navigation Grid {%- endcomment -%}
    <div class="matrix-grid">
      
      {% for block in section.blocks %}
        <a 
          href="{{ block.settings.link_url }}" 
          class="matrix-item"
          data-block-id="{{ block.id }}"
          data-glow-color="{{ block.settings.glow_color }}"
          {{ block.shopify_attributes }}
        >
          
          {%- comment -%} Icon Container {%- endcomment -%}
          <div class="matrix-icon">
            {% if block.settings.custom_icon != blank %}
              <img 
                src="{{ block.settings.custom_icon | image_url: width: 200 }}" 
                alt="{{ block.settings.title }}"
                loading="lazy"
                class="icon-image"
              >
            {% else %}
              {%- comment -%} Default SVG Icons {%- endcomment -%}
              {% case block.settings.icon_type %}
                {% when 'spiral' %}
                  <svg viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="3">
                    <path d="M50 50 Q60 30 70 30 Q80 30 80 40 Q80 50 70 50 Q60 50 55 55 Q50 60 45 60 Q35 60 30 50 Q25 40 35 30 Q45 20 55 20 Q70 20 80 30" stroke-linecap="round"/>
                  </svg>
                {% when 'brain' %}
                  <svg viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M30 50 Q30 30 45 25 Q50 23 55 25 Q70 30 70 50 M50 25 L50 75 M35 40 Q35 35 40 35 M65 40 Q65 35 60 35" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                {% when 'infinity' %}
                  <svg viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="3">
                    <path d="M20 50 Q30 30 40 30 Q50 30 50 40 Q50 50 40 50 Q30 50 20 70 M80 50 Q70 70 60 70 Q50 70 50 60 Q50 50 60 50 Q70 50 80 30" stroke-linecap="round"/>
                  </svg>
                {% when 'moon' %}
                  <svg viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="3">
                    <path d="M70 25 Q55 25 45 35 Q35 45 35 60 Q35 75 45 85 Q55 95 70 95 Q80 95 85 85 Q90 75 85 60" stroke-linecap="round"/>
                  </svg>
                {% when 'robot' %}
                  <svg viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="2.5">
                    <rect x="30" y="35" width="40" height="45" rx="5"/>
                    <circle cx="42" cy="50" r="4"/>
                    <circle cx="58" cy="50" r="4"/>
                    <path d="M40 65 L60 65 M50 20 L50 35 M20 50 L30 50 M70 50 L80 50"/>
                  </svg>
                {% when 'lines' %}
                  <svg viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="3">
                    <line x1="25" y1="35" x2="75" y2="35" stroke-linecap="round"/>
                    <line x1="25" y1="50" x2="75" y2="50" stroke-linecap="round"/>
                    <line x1="25" y1="65" x2="75" y2="65" stroke-linecap="round"/>
                  </svg>
                {% when 'diamond' %}
                  <svg viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="3">
                    <path d="M50 20 L75 50 L50 80 L25 50 Z" stroke-linejoin="round"/>
                    <path d="M35 35 L65 35 L50 50 Z"/>
                  </svg>
                {% when 'skull' %}
                  <svg viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="2.5">
                    <ellipse cx="50" cy="45" rx="20" ry="25"/>
                    <circle cx="42" cy="40" r="4" fill="currentColor"/>
                    <circle cx="58" cy="40" r="4" fill="currentColor"/>
                    <rect x="45" y="55" width="10" height="15"/>
                  </svg>
                {% else %}
                  <svg viewBox="0 0 100 100" fill="none" stroke="currentColor" stroke-width="3">
                    <circle cx="50" cy="50" r="30" stroke-linecap="round"/>
                    <path d="M50 35 L50 50 L60 60" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
              {% endcase %}
            {% endif %}
          </div>
          
          {%- comment -%} Label Text {%- endcomment -%}
          <div class="matrix-label">
            <span class="label-text">{{ block.settings.title | upcase }}</span>
          </div>
          
          {%- comment -%} Hover Glow Effect {%- endcomment -%}
          <div class="matrix-glow" aria-hidden="true"></div>
          
        </a>
      {% endfor %}
      
    </div>
    
  </div>
  
</section>

<style>
  .navigation-matrix {
    position: relative;
    padding: 6rem 0;
    background: #000000;
    overflow: hidden;
  }
  
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
  }
  
  /* ────────────────────────────────────────────────────────
     SECTION HEADER
     ──────────────────────────────────────────────────────── */
  
  .matrix-header {
    text-align: center;
    margin-bottom: 4rem;
  }
  
  .matrix-heading {
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 900;
    letter-spacing: 0.05em;
    color: #ffffff;
    margin: 0 0 1rem;
    text-transform: uppercase;
    background: linear-gradient(135deg, #00f0ff 0%, #ff00ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .matrix-subheading {
    font-size: 1.125rem;
    color: rgba(255, 255, 255, 0.7);
    max-width: 600px;
    margin: 0 auto;
  }
  
  /* ────────────────────────────────────────────────────────
     MATRIX GRID
     ──────────────────────────────────────────────────────── */
  
  .matrix-grid {
    display: grid;
    grid-template-columns: repeat(var(--grid-columns, 4), 1fr);
    gap: 2rem;
  }
  
  /* ────────────────────────────────────────────────────────
     MATRIX ITEMS
     ──────────────────────────────────────────────────────── */
  
  .matrix-item {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1.5rem;
    padding: 3rem 2rem;
    aspect-ratio: 1;
    text-decoration: none;
    background: rgba(255, 255, 255, 0.02);
    border: 2px solid rgba(0, 240, 255, 0.2);
    border-radius: 20px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    overflow: hidden;
  }
  
  .matrix-item:hover {
    border-color: rgba(0, 240, 255, 0.6);
    background: rgba(0, 240, 255, 0.05);
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 60px rgba(0, 240, 255, 0.3);
  }
  
  /* ────────────────────────────────────────────────────────
     ICON CONTAINER
     ──────────────────────────────────────────────────────── */
  
  .matrix-icon {
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #00f0ff;
    transition: all 0.4s ease;
  }
  
  .matrix-icon svg {
    width: 100%;
    height: 100%;
    filter: drop-shadow(0 0 10px currentColor);
  }
  
  .icon-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    filter: drop-shadow(0 0 10px rgba(0, 240, 255, 0.6));
  }
  
  .matrix-item:hover .matrix-icon {
    transform: scale(1.1) rotate(5deg);
    color: #ffffff;
    filter: drop-shadow(0 0 20px currentColor);
  }
  
  /* ────────────────────────────────────────────────────────
     LABEL TEXT
     ──────────────────────────────────────────────────────── */
  
  .matrix-label {
    text-align: center;
  }
  
  .label-text {
    font-size: 1rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    color: rgba(255, 255, 255, 0.9);
    text-transform: uppercase;
    transition: color 0.3s ease;
  }
  
  .matrix-item:hover .label-text {
    color: #00f0ff;
  }
  
  /* ────────────────────────────────────────────────────────
     GLOW EFFECT
     ──────────────────────────────────────────────────────── */
  
  .matrix-glow {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 200%;
    height: 200%;
    transform: translate(-50%, -50%);
    background: radial-gradient(circle, rgba(0, 240, 255, 0.3) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.4s ease;
    pointer-events: none;
  }
  
  .matrix-item:hover .matrix-glow {
    opacity: 1;
  }
  
  /* Custom glow colors per item */
  .matrix-item[data-glow-color="magenta"]:hover .matrix-glow {
    background: radial-gradient(circle, rgba(255, 0, 255, 0.3) 0%, transparent 70%);
  }
  
  .matrix-item[data-glow-color="gold"]:hover .matrix-glow {
    background: radial-gradient(circle, rgba(255, 215, 0, 0.3) 0%, transparent 70%);
  }
  
  .matrix-item[data-glow-color="purple"]:hover .matrix-glow {
    background: radial-gradient(circle, rgba(157, 0, 255, 0.3) 0%, transparent 70%);
  }
  
  .matrix-item[data-glow-color="green"]:hover .matrix-glow {
    background: radial-gradient(circle, rgba(0, 255, 136, 0.3) 0%, transparent 70%);
  }
  
  /* ────────────────────────────────────────────────────────
     RESPONSIVE
     ──────────────────────────────────────────────────────── */
  
  @media (max-width: 1024px) {
    .matrix-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
    }
  }
  
  @media (max-width: 768px) {
    .navigation-matrix {
      padding: 4rem 0;
    }
    
    .matrix-header {
      margin-bottom: 2rem;
    }
    
    .matrix-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
    
    .matrix-item {
      padding: 2rem 1.5rem;
    }
    
    .matrix-icon {
      width: 60px;
      height: 60px;
    }
    
    .label-text {
      font-size: 0.875rem;
    }
  }
  
  @media (max-width: 480px) {
    .matrix-grid {
      grid-template-columns: 1fr;
    }
  }
  
  /* ────────────────────────────────────────────────────────
     ACCESSIBILITY
     ──────────────────────────────────────────────────────── */
  
  .matrix-item:focus {
    outline: 3px solid #00f0ff;
    outline-offset: 4px;
  }
  
  @media (prefers-reduced-motion: reduce) {
    .matrix-item,
    .matrix-icon,
    .matrix-glow {
      transition: none;
      animation: none;
    }
    
    .matrix-item:hover {
      transform: none;
    }
  }
</style>

<script>
  (function() {
    const matrixItems = document.querySelectorAll('.matrix-item');
    
    matrixItems.forEach(item => {
      // Track navigation clicks
      item.addEventListener('click', function(e) {
        if (typeof window.stellarAnalytics !== 'undefined') {
          window.stellarAnalytics.track('navigation_matrix_click', {
            label: this.querySelector('.label-text')?.textContent.trim(),
            destination: this.getAttribute('href')
          });
        }
      });
      
      // Add parallax-style hover effect
      item.addEventListener('mousemove', function(e) {
        const rect = this.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        const rotateX = (y - centerY) / 10;
        const rotateY = (centerX - x) / 10;
        
        const icon = this.querySelector('.matrix-icon');
        if (icon) {
          icon.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.1)`;
        }
      });
      
      item.addEventListener('mouseleave', function() {
        const icon = this.querySelector('.matrix-icon');
        if (icon) {
          icon.style.transform = '';
        }
      });
    });
  })();
</script>

{% schema %}
{
  "name": "Navigation Matrix",
  "tag": "section",
  "class": "section-navigation-matrix",
  "max_blocks": 12,
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "checkbox",
      "id": "show_heading",
      "label": "Show section heading",
      "default": true
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "NAVIGATE THE SIGNAL"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading"
    },
    {
      "type": "range",
      "id": "grid_columns",
      "label": "Columns (desktop)",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 4
    }
  ],
  "blocks": [
    {
      "type": "nav_item",
      "name": "Navigation Item",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Archive"
        },
        {
          "type": "url",
          "id": "link_url",
          "label": "Link URL"
        },
        {
          "type": "select",
          "id": "icon_type",
          "label": "Icon Type",
          "options": [
            { "value": "spiral", "label": "Spiral" },
            { "value": "brain", "label": "Brain" },
            { "value": "infinity", "label": "Infinity" },
            { "value": "moon", "label": "Moon" },
            { "value": "robot", "label": "Robot" },
            { "value": "lines", "label": "Lines" },
            { "value": "diamond", "label": "Diamond" },
            { "value": "skull", "label": "Skull" },
            { "value": "custom", "label": "Custom Image" }
          ],
          "default": "spiral"
        },
        {
          "type": "image_picker",
          "id": "custom_icon",
          "label": "Custom Icon Image",
          "info": "Upload icon if 'Custom Image' is selected"
        },
        {
          "type": "select",
          "id": "glow_color",
          "label": "Hover Glow Color",
          "options": [
            { "value": "cyan", "label": "Cyan" },
            { "value": "magenta", "label": "Magenta" },
            { "value": "gold", "label": "Gold" },
            { "value": "purple", "label": "Purple" },
            { "value": "green", "label": "Green" }
          ],
          "default": "cyan"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Navigation Matrix",
      "blocks": [
        {
          "type": "nav_item",
          "settings": {
            "title": "All Capsules",
            "icon_type": "spiral",
            "glow_color": "cyan"
          }
        },
        {
          "type": "nav_item",
          "settings": {
            "title": "About",
            "icon_type": "brain",
            "glow_color": "magenta"
          }
        },
        {
          "type": "nav_item",
          "settings": {
            "title": "Lore",
            "icon_type": "infinity",
            "glow_color": "purple"
          }
        },
        {
          "type": "nav_item",
          "settings": {
            "title": "Shop",
            "icon_type": "diamond",
            "glow_color": "gold"
          }
        }
      ]
    }
  ]
}
{% endschema %}
