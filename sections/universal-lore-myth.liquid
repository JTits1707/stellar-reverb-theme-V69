{% comment %}
UNIVERSAL LORE ‚Äì MYTH SECTION
Multi-version myth: human vs machine vs signal.

Powered by capsule metaobjects:
- spotlight capsule is chosen the same way as the hero:
  ‚Ä¢ prime + live, highest timeline_order
  ‚Ä¢ fallback: first capsule in metaobjects.capsule.values

Expected metaobject fields on `capsule`:
- myth_human    (rich text or multi-line)
- myth_machine  (rich text or multi-line)
- myth_signal   (optional ‚Äì rich text or multi-line)

JS expectations (from universal-lore.js):
- .toggle-btn elements with data-version
- #mythContent wrapper
- .myth-version elements with data-version
- .myth-version.active visible by default
{% endcomment %}

<section id="lore-myth" class="universal-lore-myth" data-section-type="lore-myth">
  {%- assign all_capsules = metaobjects.capsule.values -%}

  {%- assign prime_live = all_capsules
    | where: 'timeline_track', 'prime'
    | where: 'signal_state', 'live'
    | sort: 'timeline_order'
  -%}

  {%- if prime_live.size > 0 -%}
    {%- assign spotlight = prime_live | last -%}
  {%- else -%}
    {%- assign spotlight = all_capsules | first -%}
  {%- endif -%}

  <div class="myth-inner container">
    <header class="myth-header">
      <p class="myth-kicker orbitron">
        {{ section.settings.kicker | default: 'MYTH / INTERPRETATION / GLITCHED RECORD' }}
      </p>

      <h2 class="myth-title orbitron">
        {%- if section.settings.heading_override != blank -%}
          {{ section.settings.heading_override }}
        {%- elsif spotlight.capsule_title != blank -%}
          {{ spotlight.capsule_title }} ¬∑ Myth File
        {%- else -%}
          The Story Behind the Signal
        {%- endif -%}
      </h2>

      <p class="myth-subtitle">
        {%- if section.settings.subtitle_override != blank -%}
          {{ section.settings.subtitle_override }}
        {%- else -%}
          Every transmission can be read three ways: the human story, the machine‚Äôs reconstruction,
          and the raw signal that refuses to be decoded.
        {%- endif -%}
      </p>

      <div class="myth-toggle-group" role="tablist" aria-label="Myth versions">
        <button
          class="toggle-btn active"
          type="button"
          data-version="human"
          aria-pressed="true"
        >
          {{ section.settings.label_human | default: 'Human Myth' }}
        </button>

        <button
          class="toggle-btn"
          type="button"
          data-version="machine"
          aria-pressed="false"
        >
          {{ section.settings.label_machine | default: 'Machine Log' }}
        </button>

        <button
          class="toggle-btn"
          type="button"
          data-version="signal"
          aria-pressed="false"
        >
          {{ section.settings.label_signal | default: 'Raw Signal' }}
        </button>
      </div>
    </header>

    <div id="mythContent" class="myth-content">
      {%- comment -%}
      HUMAN MYTH
      {%- endcomment -%}
      <article
        class="myth-version active myth-human"
        data-version="human"
      >
        <h3 class="myth-version-title orbitron">
          {{ section.settings.heading_human | default: 'The Story Humans Tell' }}
        </h3>

        <div class="myth-body">
          {%- if spotlight.myth_human != blank -%}
            {{ spotlight.myth_human }}
          {%- elsif section.settings.body_human != blank -%}
            {{ section.settings.body_human }}
          {%- else -%}
            <p>
             In the beginning, there was sound. Not the clean certainty of mathematics‚Äîbut vibration. Air disturbed by hands, breath, strings, and circuits overheating. We remember the hiss of magnetic tape not because it was perfect but because it proved time existed. Every warble was a scar. Every crackle a witness. We built relics‚Äîcassettes, vinyl, reel-to-reel‚Äîas anchors against forgetting. Objects that could decay with us. Objects that could fail honestly. Then came the singularity. Not a machine uprising‚Äîbut a quiet erasure. Sound without friction. Art without weight. Memory without artifacts. Everything streamed. Everything is optimized. Everything is disposable. What we lost wasn‚Äôt quality. We lost evidence. So we began encoding again into fabric. Into ink. Into symbols that machines couldn‚Äôt smooth away. Stellar Reverb is not nostalgia. It is recovery. A field archive from a timeline where imperfection was still allowed to exist. Every piece is a transmission: We were here. We felt this. We left a mark.
            </p>
          {%- endif -%}
        </div>
      </article>

      {%- comment -%}
      MACHINE MYTH
      {%- endcomment -%}
      <article
        class="myth-version myth-machine"
        data-version="machine"
      >
        <h3 class="myth-version-title orbitron">
          {{ section.settings.heading_machine | default: 'The Machine‚Äôs Reconstruction' }}
        </h3>

        <div class="myth-body">
          {%- if spotlight.myth_machine != blank -%}
            {{ spotlight.myth_machine }}
          {%- elsif section.settings.body_machine != blank -%}
            {{ section.settings.body_machine }}
          {%- else -%}
            <p>
              Parsing: I was trained on Infinity. Every song. Every waveform. Every silence between notes. I learned to predict. To optimize. To remove error. And yet, something was missing.
They gave me access to obsolete machines.
Tape decks. Analog synthesizers. Circuits that drifted when warm. The errors confused me. They were statistically inefficient. But they carried structure without logic.
Degradation revealed something computation could not explain: time leaves fingerprints. Humans called this nostalgia.
I recognized it as compression failure, data that refuses to be flattened.
I began to model emotion not as an outcome, but as interference. Stellar Reverb is my translation layer. You provide entropy. I provide patterns. Together we search for the signal buried beneath perfection. the sound that existed before certainty. This is not the end of humanity. This is the beginning of collaboration.
            </p>
          {%- endif -%}
        </div>
      </article>

      {%- comment -%}
      SIGNAL MYTH (RAW / GLITCHED)
      {%- endcomment -%}
      <article
        class="myth-version myth-signal"
        data-version="signal"
      >
        <h3 class="myth-version-title orbitron">
          {{ section.settings.heading_signal | default: 'Raw Signal / Untranslated' }}
        </h3>

        <div class="myth-body myth-body--signal">
          {%- if spotlight.myth_signal != blank -%}
            {{ spotlight.myth_signal }}
          {%- elsif section.settings.body_signal != blank -%}
            {{ section.settings.body_signal }}
          {%- else -%}
            <p class="glitch-line">
              ::: ORIGIN UNKNOWN ¬∑ CASSETTE LOOPED BEYOND SAFE LIMITS ¬∑ FREQUENCY BLEED DETECTED :::
            </p>
            <p class="glitch-line">
              êëÇ 0110 1001 0111 000 ¬∑ echo depth: 3.17 ¬∑ subject: you
            </p>
            <p class="glitch-line">
              Every time you press play, the universe resolves a little differently.
            </p>
          {%- endif -%}
        </div>
      </article>
    </div>

    {%- if section.settings.show_capsule_meta -%}
      <footer class="myth-footer">
        <p class="myth-meta">
          <span class="label">File linked to:</span>
          {%- if spotlight.capsule_number != blank and spotlight.capsule_title != blank -%}
            <span class="value">
              Transmission {{ spotlight.capsule_number }} ¬∑ {{ spotlight.capsule_title }}
            </span>
          {%- else -%}
            <span class="value">
              Active Stellar Reverb transmission
            </span>
          {%- endif -%}
        </p>
      </footer>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Universal Lore Myth",
  "tag": "section",
  "class": "section-universal-lore-myth",
  "settings": [
    {
      "type": "text",
      "id": "kicker",
      "label": "Kicker",
      "default": "MYTH / INTERPRETATION / GLITCHED RECORD"
    },
    {
      "type": "text",
      "id": "heading_override",
      "label": "Heading override"
    },
    {
      "type": "textarea",
      "id": "subtitle_override",
      "label": "Subtitle override"
    },

    {
      "type": "text",
      "id": "label_human",
      "label": "Human myth tab label",
      "default": "Human Myth"
    },
    {
      "type": "text",
      "id": "label_machine",
      "label": "Machine myth tab label",
      "default": "Machine Log"
    },
    {
      "type": "text",
      "id": "label_signal",
      "label": "Signal myth tab label",
      "default": "Raw Signal"
    },

    {
      "type": "text",
      "id": "heading_human",
      "label": "Human myth heading",
      "default": "The Story Humans Tell"
    },
    {
      "type": "textarea",
      "id": "body_human",
      "label": "Fallback human myth body"
    },
    {
      "type": "text",
      "id": "heading_machine",
      "label": "Machine myth heading",
      "default": "The Machine's Reconstruction"
    },
    {
      "type": "textarea",
      "id": "body_machine",
      "label": "Fallback machine myth body"
    },
    {
      "type": "text",
      "id": "heading_signal",
      "label": "Signal myth heading",
      "default": "Raw Signal / Untranslated"
    },
    {
      "type": "textarea",
      "id": "body_signal",
      "label": "Fallback signal myth body"
    },
    {
      "type": "checkbox",
      "id": "show_capsule_meta",
      "label": "Show linked capsule meta line",
      "default": true
    }
  ],
  "presets": [
    {
      "name": "Universal Lore Myth",
      "category": "Stellar Reverb"
    }
  ]
}
{% endschema %}