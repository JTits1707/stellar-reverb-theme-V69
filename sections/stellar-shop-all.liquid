{% comment %}
  STELLAR REVERB – COSMIC PRODUCT VAULT / SHOP ALL
  Section: stellar-shop-all.liquid

  Fuses:
  - Hero + brand icon (from stellar_shop.html)
  - Transmission strip + sticky filter bar (from shop-all-V1-fix-stick-bar.html)
  - Motif chips / visual tags (from cosmic_product_vault.html)
  - Dynamic product grid with:
      • Capsule tags
      • Limited / exclusive / signal-seeker badges
      • FOMO inventory messaging
  - Cross-sell / upsell block
  - Signal CTA at bottom

  Expected CSS hooks (map to your existing CSS/base.css):
  - .cosmic-bg, .cosmic-particles, .stellar-vault, .filter-pills, .filter-pill
  - .product-grid, .product-card, .product-image
  - .badge, .badge-limited, .badge-exclusive, .badge-signal-seeker, .badge-new
  - .chip, .chip-soft, .chip-outline, .chip-sale
  - .sticky-filters for sticky capsule bar
{% endcomment %}
{{ 'stellar-shop-all.css' | asset_url | stylesheet_tag }}
<script src="{{ 'stellar-shop-all.js' | asset_url }}" defer></script>

{% assign collection_handle = collection.handle %}
{% assign all_products = collection.products %}

<section
  class="stellar-vault cosmic-bg"
  data-section-id="{{ section.id }}"
  data-section-type="stellar-shop-all"
>
  <div class="cosmic-particles" aria-hidden="true"></div>

  {%- comment -%}
    HERO AREA – Brand icon, headline, subcopy
  {%- endcomment -%}
  <header class="stellar-hero container mx-auto px-6 pt-12 pb-8 text-center relative">
    <div class="hero-inner inline-block relative">
      {% if section.settings.hero_show_brand_icon %}
        <div class="hero-brand-icon mb-4 flex justify-center">
          {%- comment -%}
            Use your existing logo or capsule icon. Replace 'stellar-logo.png' with your asset.
          {%- endcomment -%}
          <img
            src="{{ 'stellar-logo.png' | asset_url }}"
            alt="{{ shop.name }} logo"
            class="h-12 w-auto hero-logo"
          >
        </div>
      {% endif %}

      {% if section.settings.hero_kicker != blank %}
        <p class="hero-kicker orbitron text-xs tracking-[0.2em] uppercase mb-2 text-gradient-magenta-cyan">
          {{ section.settings.hero_kicker }}
        </p>
      {% endif %}

      <h1 class="hero-title orbitron text-4xl md:text-6xl font-black uppercase tracking-[0.1em] mb-4 glitch-text text-white">
        {{ section.settings.hero_title }}
      </h1>

      {% if section.settings.hero_subtitle != blank %}
        <p class="hero-subtitle montserrat text-lg md:text-xl max-w-2xl mx-auto text-silver leading-relaxed">
          {{ section.settings.hero_subtitle }}
        </p>
      {% endif %}
    </div>
  </header>

  {%- comment -%}
    TRANSMISSION STRIP – Incoming message + lore fragments
  {%- endcomment -%}
  {% if section.settings.transmission_strip_enabled %}
    <div class="transmission-strip container mx-auto px-6 py-4 bg-void/50 border border-magenta/30 rounded-lg shadow-glow-magenta mb-8">
      <div class="transmission-inner flex items-center justify-between">
        <p class="transmission-text montserrat text-sm text-silver">
          {{ section.settings.transmission_text }}
        </p>
        <div class="lore-fragments orbitron text-xs uppercase text-cyan animate-pulse">
          {% assign lore_array = section.settings.lore_fragments | split: '||' %}
          {% for lore in lore_array %}
            <span class="lore-fragment" style="display: none;">{{ lore | strip }}</span>
          {% endfor %}
        </div>
      </div>
    </div>
  {% endif %}

  {%- comment -%}
    STICKY FILTER BAR – Capsule pills + motif filters
  {%- endcomment -%}
  <div class="sticky-filters sticky top-0 bg-void/80 backdrop-blur-md z-10 py-4 border-b border-purple/20 shadow-glow-purple">
    <div class="container mx-auto px-6">
      {% if section.settings.show_capsule_filters %}
        <div class="capsule-row flex flex-wrap gap-2 justify-center mb-4">
          <button class="filter-pill chip-soft" data-filter-type="capsule" data-filter-value="all">All Capsules</button>
          {%- for coll in collections -%}
            {% unless coll.handle == 'all' or coll.handle == 'frontpage' %}
              <button class="filter-pill chip-outline" data-filter-type="capsule" data-filter-value="{{ coll.handle | downcase }}">
                {{ coll.title }}
              </button>
            {% endunless %}
          {%- endfor -%}
          {% if section.settings.show_special_pills %}
            <button class="filter-pill chip-sale" data-filter-type="capsule" data-filter-value="signal-seeker">Signal Seeker Exclusives</button>
            <button class="filter-pill chip-sale" data-filter-type="capsule" data-filter-value="floating-archive">Floating Archive</button>
          {% endif %}
        </div>
      {% endif %}

      {% if section.settings.show_motif_filters %}
        <div class="motif-row flex flex-wrap gap-2 justify-center">
          {%- assign motifs = "Glitchwave|Neon Void|Cosmic Drift|Retro Future|Signal Burst|Echo Realm|Quantum Flux|Stellar Pulse" | split: '|' -%}
          {% for motif in motifs %}
            <button class="motif-chip chip-soft" data-filter-type="motif" data-filter-value="{{ motif | downcase | replace: ' ', '-' }}">
              {{ motif }}
            </button>
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>

  {%- comment -%}
    PRODUCT GRID – Dynamic with filters, badges, quick add
  {%- endcomment -%}
  <div class="product-grid container mx-auto px-6 py-12 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
    {% paginate collection.products by section.settings.products_per_page %}
      {% for product in all_products %}
        <div
          class="product-card relative"
          data-capsule="{{ product.collections.first.handle | downcase }}"
          data-tags="{{ product.tags | join: ',' | downcase }}"
          data-limited="{% if product.variants.first.inventory_quantity <= section.settings.fomo_inventory_threshold %}true{% else %}false{% endif %}"
          data-price="{{ product.price }}"
          data-created="{{ product.created_at | date: '%s' }}"
        >
          <a href="{{ product.url }}" class="product-image block relative overflow-hidden rounded-lg shadow-glow-cyan group">
            <img
              src="{{ product.featured_image | img_url: 'large' }}"
              alt="{{ product.title | escape }}"
              class="w-full h-auto transform transition-transform duration-300 group-hover:scale-105"
              loading="lazy"
            >
            {%- comment -%} Capsule tag {%- endcomment -%}
            {% if product.collections.first %}
              <span class="capsule-tag absolute top-2 left-2 chip-soft text-xs">
                {{ product.collections.first.title }}
              </span>
            {% endif %}

            {%- comment -%} Badges {%- endcomment -%}
            <div class="badges absolute top-2 right-2 flex flex-col gap-1">
              {% if product.tags contains 'limited' %}
                <span class="badge badge-limited text-xs">Limited Relic</span>
              {% endif %}
              {% if product.tags contains 'exclusive' %}
                <span class="badge badge-exclusive text-xs">Exclusive</span>
              {% endif %}
              {% if product.tags contains 'signal-seeker' %}
                <span class="badge badge-signal-seeker text-xs">Signal Seeker</span>
              {% endif %}
              {% if product.available == false %}
                <span class="badge badge-sold-out text-xs">Sold Out</span>
              {% endif %}
            </div>
          </a>

          <div class="product-info mt-4 text-center">
            <h3 class="product-title orbitron text-lg font-bold uppercase text-white">
              <a href="{{ product.url }}">{{ product.title }}</a>
            </h3>
            <p class="product-price montserrat text-md text-silver">
              {{ product.price | money }}
            </p>

            {%- comment -%} FOMO messaging {%- endcomment -%}
            {% if product.variants.first.inventory_quantity <= section.settings.fomo_inventory_threshold and product.available %}
              <p class="fomo-message text-yellow text-sm animate-pulse">
                Only {{ product.variants.first.inventory_quantity }} left – Extract now!
              </p>
            {% endif %}

            {% if section.settings.enable_quick_add %}
              <form method="post" action="/cart/add" class="quick-add mt-2">
                <input type="hidden" name="id" value="{{ product.variants.first.id }}">
                <button type="submit" class="btn btn-quick-add w-full">Quick Extract</button>
              </form>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    {% endpaginate %}
  </div>

  {%- comment -%}
    UPSELL / CROSS-SELL BLOCK
  {%- endcomment -%}
  {% if section.settings.upsell_collection != blank %}
    {% assign upsell_coll = collections[section.settings.upsell_collection] %}
    {% if upsell_coll.products.size > 0 %}
      <section class="upsell-block container mx-auto px-6 py-12 border-t border-purple/20">
        <header class="upsell-header text-center mb-8">
          <h2 class="upsell-heading orbitron text-3xl uppercase tracking-[0.1em] text-gradient-magenta-cyan">
            {{ section.settings.upsell_heading }}
          </h2>
          <p class="upsell-subheading montserrat text-lg text-silver">
            {{ section.settings.upsell_subheading }}
          </p>
        </header>

        <div class="upsell-grid grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-8">
          {% for product in upsell_coll.products limit: section.settings.upsell_limit %}
            <div class="upsell-card">
              <a href="{{ product.url }}" class="block">
                <img
                  src="{{ product.featured_image | img_url: 'medium' }}"
                  alt="{{ product.title | escape }}"
                  class="w-full h-auto rounded-lg shadow-glow-yellow"
                  loading="lazy"
                >
              </a>
              <h3 class="text-center mt-2 orbitron text-md uppercase text-white">
                <a href="{{ product.url }}">{{ product.title }}</a>
              </h3>
              <p class="text-center montserrat text-sm text-silver">
                {{ product.price | money }}
              </p>
            </div>
          {% endfor %}
        </div>
      </section>
    {% endif %}
  {% endif %}

  {%- comment -%}
    SIGNAL SEEKER CTA
  {%- endcomment -%}
  <section class="signal-cta container mx-auto px-6 py-16 text-center bg-void/50 border border-cyan/30 rounded-lg shadow-glow-cyan">
    <h2 class="signal-heading orbitron text-3xl uppercase tracking-[0.1em] text-gradient-cyan-magenta mb-4">
      {{ section.settings.signal_cta_heading }}
    </h2>
    <p class="signal-subheading montserrat text-lg max-w-xl mx-auto text-silver mb-8">
      {{ section.settings.signal_cta_subheading }}
    </p>
    <a href="{{ section.settings.signal_cta_link }}" class="signal-button inline-block px-8 py-3 bg-gradient-to-r from-magenta to-cyan text-white orbitron uppercase text-sm tracking-wider rounded-full shadow-glow-magenta hover:transform hover:scale-105 transition-transform">
      {{ section.settings.signal_cta_button_text }}
    </a>
  </section>
</section>

<script>
  // JavaScript for dynamic elements: lore cycling, filters, quick add (AJAX), etc.
  document.addEventListener('DOMContentLoaded', function() {
    // Lore fragments cycling
    const loreFragments = document.querySelectorAll('.lore-fragment');
    if (loreFragments.length > 0) {
      let currentLore = 0;
      loreFragments[currentLore].style.display = 'inline';
      setInterval(() => {
        loreFragments[currentLore].style.display = 'none';
        currentLore = (currentLore + 1) % loreFragments.length;
        loreFragments[currentLore].style.display = 'inline';
      }, 5000);
    }

    // Filters
    const filterPills = document.querySelectorAll('.filter-pill, .motif-chip');
    const productCards = document.querySelectorAll('.product-card');
    let activeCapsule = 'all';
    let activeMotifs = [];

    filterPills.forEach(pill => {
      pill.addEventListener('click', function() {
        const type = this.dataset.filterType;
        const value = this.dataset.filterValue;

        if (type === 'capsule') {
          filterPills.forEach(p => { if (p.dataset.filterType === 'capsule') p.classList.remove('active'); });
          this.classList.add('active');
          activeCapsule = value;
        } else if (type === 'motif') {
          this.classList.toggle('active');
          if (this.classList.contains('active')) {
            activeMotifs.push(value);
          } else {
            activeMotifs = activeMotifs.filter(m => m !== value);
          }
        }

        productCards.forEach(card => {
          const cardCapsule = card.dataset.capsule;
          const cardTags = card.dataset.tags.split(',');

          let show = (activeCapsule === 'all' || cardCapsule === activeCapsule);
          if (show && activeMotifs.length > 0) {
            show = activeMotifs.every(motif => cardTags.includes(motif));
          }

          card.style.display = show ? 'block' : 'none';
        });
      });
    });

    // Quick add AJAX
    const quickAddForms = document.querySelectorAll('.quick-add');
    quickAddForms.forEach(form => {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        fetch('/cart/add.js', {
          method: 'POST',
          body: new FormData(form),
          headers: { 'X-Requested-With': 'XMLHttpRequest' }
        }).then(response => response.json())
          .then(data => {
            // Update cart UI or show success message
            alert('Relic added to cart!');
          }).catch(error => {
            console.error('Error adding to cart:', error);
          });
      });
    });
  });
</script>

{% schema %}
{
  "name": "Stellar Shop All",
  "settings": [
    {
      "type": "checkbox",
      "id": "hero_show_brand_icon",
      "label": "Show Brand Icon in Hero",
      "default": true
    },
    {
      "type": "text",
      "id": "hero_kicker",
      "label": "Hero Kicker",
      "default": "SHOP ALL TRANSMISSIONS"
    },
    {
      "type": "text",
      "id": "hero_title",
      "label": "Hero Title",
      "default": "COSMIC PRODUCT VAULT"
    },
    {
      "type": "textarea",
      "id": "hero_subtitle",
      "label": "Hero Subtitle",
      "default": "Every capsule, every relic, every glitchwave echo — tuned into a single transmission grid."
    },
    {
      "type": "checkbox",
      "id": "transmission_strip_enabled",
      "label": "Enable Transmission Strip",
      "default": true
    },
    {
      "type": "text",
      "id": "transmission_text",
      "label": "Transmission Text",
      "default": "INCOMING TRANSMISSION: New relics materializing from the void… stand by."
    },
    {
      "type": "textarea",
      "id": "lore_fragments",
      "label": "Lore Fragments (|| separated)",
      "default": "Signal received. Grid stabilizing.||Artifacts detected across multiple timelines.||Extraction protocols armed. Choose your relic."
    },
    {
      "type": "checkbox",
      "id": "show_special_pills",
      "label": "Show Special Capsule Pills",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_capsule_filters",
      "label": "Show Capsule Filters",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_motif_filters",
      "label": "Show Motif Filters",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_quick_add",
      "label": "Enable Quick Add Buttons",
      "default": true
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products Per Page",
      "min": 12,
      "max": 48,
      "step": 4,
      "default": 24
    },
    {
      "type": "range",
      "id": "fomo_inventory_threshold",
      "label": "Inventory Threshold for FOMO Message",
      "min": 1,
      "max": 10,
      "step": 1,
      "default": 5
    },
    {
      "type": "text",
      "id": "upsell_heading",
      "label": "Upsell Heading",
      "default": "You May Also Be Receiving These Signals"
    },
    {
      "type": "text",
      "id": "upsell_subheading",
      "label": "Upsell Subheading",
      "default": "Curated relics that vibrate on a similar frequency."
    },
    {
      "type": "collection",
      "id": "upsell_collection",
      "label": "Upsell Collection"
    },
    {
      "type": "range",
      "id": "upsell_limit",
      "label": "Upsell Products Limit",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 4
    },
    {
      "type": "text",
      "id": "signal_cta_heading",
      "label": "Signal CTA Heading",
      "default": "Join The Signal Network"
    },
    {
      "type": "textarea",
      "id": "signal_cta_subheading",
      "label": "Signal CTA Subheading",
      "default": "Get early access to hidden relics, incoming capsules, and encrypted lore."
    },
    {
      "type": "text",
      "id": "signal_cta_button_text",
      "label": "Signal CTA Button Text",
      "default": "TUNE INTO FUTURE DROPS"
    },
    {
      "type": "url",
      "id": "signal_cta_link",
      "label": "Signal CTA Link"
    }
  ],
  "presets": [
    {
      "name": "Stellar Shop All",
      "category": "Stellar Reverb"
    }
  ]
}
{% endschema %}