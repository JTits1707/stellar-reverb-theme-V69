{% comment %}
  STELLAR REVERB - FEATURED SPOTLIGHT (OPTIMIZED)
{% endcomment %}

{% liquid
  assign capsule = section.settings.featured_capsule
  if capsule
    assign title = capsule.title.value
    assign number = capsule.capsule_number.value
    assign img = capsule.featured_image.value
    assign desc = capsule.description.value
    assign url = capsule.page_url.value
  else
    assign title = section.settings.manual_title
    assign number = section.settings.manual_number
    assign img = section.settings.manual_image
    assign desc = section.settings.manual_description
    assign url = section.settings.manual_url
  endif
%}

<section class="featured-spotlight" data-section-id="{{ section.id }}" data-theme="{{ section.settings.theme_color }}">
  <div class="container">
    {% if section.settings.show_heading %}
      <div class="spotlight-header">
        <h2 class="spotlight-heading">{{ section.settings.heading | default: 'FEATURED TRANSMISSION' }}</h2>
      </div>
    {% endif %}

    <div class="spotlight-card">
      <div class="spotlight-image-container">
        {% if img %}
          <img 
            src="{{ img | image_url: width: 1200 }}" 
            alt="{{ title | escape }}" 
            loading="lazy" 
            width="{{ img.width }}" 
            height="{{ img.height }}"
            class="spotlight-image">
        {% else %}
          <div class="spotlight-image-placeholder">
            <svg width="80" height="80" viewBox="0 0 120 120" fill="none" stroke="currentColor"><rect x="10" y="10" width="100" height="100" rx="8" stroke-width="2"/><path d="M30 80l20-30 15 20 25-35" stroke-width="2"/></svg>
          </div>
        {% endif %}
        <div class="spotlight-border-effect"></div>
      </div>

      <div class="spotlight-content">
        <div class="featured-tag">CAPSULE {{ number | default: 'INIT' }}</div>
        <h2 class="spotlight-title">{{ title | upcase }}</h2>
        
        <div class="featured-lore">
          <div class="lore-label">// TRANSMISSION_EXCERPT</div>
          <p class="lore-text">{{ section.settings.lore_preview | default: desc | truncate: 220 }}</p>
        </div>

        <div class="spotlight-actions">
          {% if url %}<a href="{{ url }}" class="spotlight-btn spotlight-btn--primary"><span>EXPLORE_CAPSULE</span></a>{% endif %}
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .featured-spotlight { padding: 6rem 0; background: #000; }
  .spotlight-card { display: grid; grid-template-columns: 1fr 1fr; gap: 4rem; align-items: center; background: rgba(255,255,255,0.02); border: 1px solid rgba(0,240,255,0.2); border-radius: 20px; padding: 3rem; backdrop-filter: blur(10px); }
  .spotlight-image-container { position: relative; aspect-ratio: 1; border-radius: 12px; overflow: hidden; }
  .spotlight-image { width: 100%; height: 100%; object-fit: cover; }
  .spotlight-border-effect { position: absolute; inset: -2px; border-radius: 12px; background: linear-gradient(45deg, #00f0ff, #ff00ff, #00f0ff); background-size: 200%; opacity: 0; transition: 0.4s; z-index: -1; }
  .spotlight-card:hover .spotlight-border-effect { opacity: 0.6; animation: rotate 3s linear infinite; }
  @keyframes rotate { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }
  @media (max-width: 1024px) { .spotlight-card { grid-template-columns: 1fr; } }
</style>

{% schema %}
{
  "name": "Featured Spotlight",
  "settings": [
    { "type": "checkbox", "id": "show_heading", "label": "Show Heading", "default": true },
    { "type": "text", "id": "heading", "label": "Heading", "default": "FEATURED" },
    { "type": "metaobject", "id": "featured_capsule", "label": "Capsule Metaobject", "metaobject_type": "capsule_archive" },
    { "type": "text", "id": "manual_number", "label": "Manual #", "default": "001" },
    { "type": "text", "id": "manual_title", "label": "Manual Title", "default": "UNTITLED" },
    { "type": "image_picker", "id": "manual_image", "label": "Manual Image" },
    { "type": "textarea", "id": "manual_description", "label": "Manual Description" },
    { "type": "textarea", "id": "lore_preview", "label": "Lore Excerpt" },
    { "type": "url", "id": "manual_url", "label": "Link URL" },
    { "type": "select", "id": "theme_color", "label": "Theme", "default": "cyan-magenta", "options": [
        { "value": "cyan-magenta", "label": "Cyan-Magenta" },
        { "value": "gold-cyan", "label": "Gold-Cyan" }
    ]}
  ],
  "presets": [{ "name": "Featured Spotlight" }]
}
{% endschema %}
