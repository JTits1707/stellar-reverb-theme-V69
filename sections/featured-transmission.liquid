{% comment %}
  ═══════════════════════════════════════════════════════════
  STELLAR REVERB - FEATURED TRANSMISSION SPOTLIGHT (CLEAN)
  ═══════════════════════════════════════════════════════════
{% endcomment %}

{% liquid
  assign featured_capsule = section.settings.featured_capsule
  assign theme_color = section.settings.theme_color | default: 'cyan-magenta'
  assign show_badge = section.settings.show_badge | default: true
  
  if featured_capsule
    assign capsule_title = featured_capsule.title.value
    assign capsule_number = featured_capsule.capsule_number.value
    assign capsule_image = featured_capsule.featured_image.value
    assign capsule_description = featured_capsule.description.value
    assign capsule_url = featured_capsule.page_url.value
  else
    assign capsule_title = section.settings.manual_title
    assign capsule_number = section.settings.manual_number
    assign capsule_image = section.settings.manual_image
    assign capsule_description = section.settings.manual_description
    assign capsule_url = section.settings.manual_url
  endif
%}

<section class="featured-spotlight" data-section-id="{{ section.id }}" data-theme="{{ theme_color }}">
  <div class="container">
    {% if section.settings.show_heading %}
      <div class="spotlight-header">
        <h2 class="spotlight-heading">{{ section.settings.heading | default: 'FEATURED TRANSMISSION' }}</h2>
        {% if section.settings.subheading != blank %}<p class="spotlight-subheading">{{ section.settings.subheading }}</p>{% endif %}
      </div>
    {% endif %}

    <div class="spotlight-card">
      {% if show_badge %}
        <div class="spotlight-badge">
          <svg class="badge-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 0l2.939 6.366L20 7.607l-5.455 4.763L16.18 20 10 16.366 3.82 20l1.635-7.63L0 7.607l7.061-1.241z"/>
          </svg>
          {{ section.settings.badge_text | default: 'FEATURED TRANSMISSION' }}
        </div>
      {% endif %}

      <div class="spotlight-image-container">
        {% if capsule_image %}
          <img src="{{ capsule_image | image_url: width: 1200 }}" alt="{{ capsule_title }}" loading="lazy" class="spotlight-image">
        {% else %}
          <div class="spotlight-image-placeholder">
            <svg width="80" height="80" viewBox="0 0 120 120" fill="none" stroke="currentColor"><rect x="10" y="10" width="100" height="100" rx="8" stroke-width="2"/><path d="M30 80l20-30 15 20 25-35" stroke-width="2"/></svg>
          </div>
        {% endif %}
        <div class="spotlight-border-effect" aria-hidden="true"></div>
      </div>

      <div class="spotlight-content">
        <div class="featured-tag">{% if capsule_number != blank %}CAPSULE {{ capsule_number }}{% else %}TRANSMISSION_INIT{% endif %}</div>
        <h2 class="spotlight-title">{{ capsule_title | upcase }}</h2>
        
        {% assign lore_text = section.settings.lore_preview | default: capsule_description %}
        {% if lore_text != blank %}
          <div class="featured-lore">
            <div class="lore-label">// TRANSMISSION_EXCERPT</div>
            <p class="lore-text">{{ lore_text | truncate: 250 }}</p>
          </div>
        {% endif %}

        {% if section.settings.show_metadata %}
          <div class="spotlight-metadata">
            {% if featured_capsule.release_date.value %}<div class="metadata-tag">REL: {{ featured_capsule.release_date.value | date: "%Y.%m" }}</div>{% endif %}
            {% if section.settings.item_count != blank %}<div class="metadata-tag">ITEMS: {{ section.settings.item_count }}</div>{% endif %}
          </div>
        {% endif %}

        <div class="spotlight-actions">
          {% if capsule_url != blank %}
            <a href="{{ capsule_url }}" class="spotlight-btn spotlight-btn--primary">
              <span>{{ section.settings.primary_cta_text | default: 'EXPLORE_CAPSULE' }}</span>
            </a>
          {% endif %}
          {% if section.settings.secondary_cta_text != blank %}
            <a href="{{ section.settings.secondary_cta_url }}" class="spotlight-btn spotlight-btn--secondary">{{ section.settings.secondary_cta_text }}</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .featured-spotlight { position: relative; padding: 6rem 0; background: #000; }
  .spotlight-card { display: grid; grid-template-columns: 1fr 1fr; gap: 4rem; align-items: center; background: rgba(255,255,255,0.02); border: 1px solid rgba(0,240,255,0.2); border-radius: 20px; padding: 3rem; backdrop-filter: blur(10px); }
  .spotlight-image-container { position: relative; aspect-ratio: 1; border-radius: 12px; overflow: hidden; }
  .spotlight-image { width: 100%; height: 100%; object-fit: cover; }
  .spotlight-badge { position: absolute; top: -1rem; left: 2rem; display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #ffd700, #ff8c00); border-radius: 30px; z-index: 10; color: #000; font-weight: 700; }
  .spotlight-border-effect { position: absolute; inset: -2px; border-radius: 12px; background: linear-gradient(45deg, #00f0ff, #ff00ff, #00f0ff); background-size: 200%; opacity: 0; transition: 0.4s; animation: gradient-rotate 3s linear infinite; z-index: -1; }
  .spotlight-card:hover .spotlight-border-effect { opacity: 0.6; }
  @keyframes gradient-rotate { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }
  @media (max-width: 1024px) { .spotlight-card { grid-template-columns: 1fr; } }
</style>

{% schema %}
{
  "name": "Featured Spotlight",
  "settings": [
    { "type": "checkbox", "id": "show_heading", "label": "Show Heading", "default": true },
    { "type": "text", "id": "heading", "label": "Heading", "default": "FEATURED TRANSMISSION" },
    { "type": "textarea", "id": "subheading", "label": "Subheading" },
    { "type": "metaobject", "id": "featured_capsule", "label": "Select Capsule", "metaobject_type": "capsule_archive" },
    { "type": "text", "id": "manual_number", "label": "Capsule #", "default": "001" },
    { "type": "text", "id": "manual_title", "label": "Title", "default": "UNTITLED" },
    { "type": "image_picker", "id": "manual_image", "label": "Image" },
    { "type": "textarea", "id": "manual_description", "label": "Description" },
    { "type": "textarea", "id": "lore_preview", "label": "Lore Excerpt" },
    { "type": "url", "id": "manual_url", "label": "Link URL" },
    { "type": "checkbox", "id": "show_badge", "label": "Show Badge", "default": true },
    { "type": "text", "id": "badge_text", "label": "Badge Text", "default": "FEATURED TRANSMISSION" },
    { "type": "text", "id": "primary_cta_text", "label": "Primary CTA", "default": "EXPLORE_CAPSULE" },
    { "type": "text", "id": "secondary_cta_text", "label": "Secondary CTA", "default": "READ_LORE" },
    { "type": "url", "id": "secondary_cta_url", "label": "Secondary URL" },
    { "type": "checkbox", "id": "show_metadata", "label": "Show Metadata", "default": true },
    { "type": "text", "id": "item_count", "label": "Item Count" },
    { "type": "select", "id": "theme_color", "label": "Theme", "default": "cyan-magenta", "options": [
        { "value": "cyan-magenta", "label": "Cyan-Magenta" },
        { "value": "gold-cyan", "label": "Gold-Cyan" }
    ]}
  ],
  "presets": [{ "name": "Featured Transmission Spotlight" }]
}
{% endschema %}