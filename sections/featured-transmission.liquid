{% comment %}
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  STELLAR REVERB - FEATURED TRANSMISSION (SECTION)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Purpose: Hero spotlight for current featured capsule
  Features:
    - Large image with parallax effect
    - Lore preview text
    - Neon-styled CTA
    - Can pull from metaobject or use manual content

  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{% endcomment %}

<section
  class="featured-transmission"
  data-section-id="{{ section.id }}"
  data-section-type="featured-transmission"
>

  {%- comment -%} Pull featured capsule from product if specified {%- endcomment -%}
  {%- if section.settings.featured_product != blank -%}
    {%- assign featured_capsule = section.settings.featured_product -%}
  {%- else -%}
    {%- assign source_collection = collections[section.settings.collection_handle] | default: collections['transmissions'] -%}
    {%- assign featured_capsule = source_collection.products | first -%}
  {%- endif -%}

  <div class="featured-container">

    {%- comment -%} Featured Image Side {%- endcomment -%}
    <div class="featured-image-wrapper">
      <div class="featured-image-container" data-parallax>

        {%- comment -%} Capsule Tag Image (Primary Visual) {%- endcomment -%}
        {% if section.settings.capsule_tag_image != blank %}
          <img
            src="{{ section.settings.capsule_tag_image | image_url: width: 1200 }}"
            alt="{{ section.settings.capsule_title | escape }} - Capsule Tag"
            class="featured-image capsule-tag-image"
            loading="lazy"
          >
        {% elsif featured_capsule.metafields.custom.capsule_tag_image != blank %}
          <img
            src="{{ featured_capsule.metafields.custom.capsule_tag_image | image_url: width: 1200 }}"
            alt="{{ featured_capsule.title | escape }} - Capsule Tag"
            class="featured-image capsule-tag-image"
            loading="lazy"
          >
        {%- comment -%} Fallback to product image if no capsule tag {%- endcomment -%}
        {% elsif featured_capsule.featured_image != blank %}
          <img
            src="{{ featured_capsule.featured_image | image_url: width: 1200 }}"
            alt="{{ featured_capsule.title | escape }}"
            class="featured-image"
            loading="lazy"
          >
        {% elsif section.settings.featured_image != blank %}
          <img
            src="{{ section.settings.featured_image | image_url: width: 1200 }}"
            alt="{{ section.settings.capsule_title | escape }}"
            class="featured-image"
            loading="lazy"
          >
        {% else %}
          <img
            src="{{ 'placeholder-capsule.jpg' | asset_url }}"
            alt="Featured Transmission"
            class="featured-image"
            loading="lazy"
          >
        {% endif %}

        {%- comment -%} Neon Glow Overlay {%- endcomment -%}
        <div class="featured-image-glow"></div>

        {%- comment -%} Badge {%- endcomment -%}
        <div class="featured-badge">
          <span class="badge-icon">âœ¦</span>
          <span class="badge-text">FEATURED</span>
        </div>

      </div>
    </div>

    {%- comment -%} Content Side {%- endcomment -%}
    <div class="featured-content">

      {%- comment -%} Tag {%- endcomment -%}
      <div class="featured-tag orbitron">
        {% if section.settings.capsule_number != blank %}
          CAPSULE {{ section.settings.capsule_number }}
        {% else %}
          TRANSMISSION
        {% endif %}
      </div>

      {%- comment -%} Title {%- endcomment -%}
      <h2 class="featured-title orbitron">
        {{ section.settings.capsule_title | default: 'FEATURED TRANSMISSION' | upcase }}
      </h2>

      {%- comment -%} Subtitle {%- endcomment -%}
      {% if section.settings.subtitle != blank %}
        <p class="featured-subtitle">
          {{ section.settings.subtitle }}
        </p>
      {% endif %}

      {%- comment -%} Description {%- endcomment -%}
      {% if section.settings.description != blank %}
        <div class="featured-description">
          {{ section.settings.description }}
        </div>
      {% endif %}

      {%- comment -%} Lore Preview {%- endcomment -%}
      {% if section.settings.lore_preview != blank %}
        <div class="featured-lore">
          <div class="lore-label orbitron">// TRANSMISSION EXCERPT</div>
          <p class="lore-text">{{ section.settings.lore_preview }}</p>
        </div>
      {% endif %}

      {%- comment -%} Stats/Metadata {%- endcomment -%}
      <div class="featured-meta">

        {% if section.settings.release_date != blank %}
          <div class="meta-item">
            <span class="meta-icon">ğŸ“…</span>
            <span class="meta-label">RELEASED:</span>
            <span class="meta-value">{{ section.settings.release_date }}</span>
          </div>
        {% endif %}

        {% if section.settings.theme != blank %}
          <div class="meta-item">
            <span class="meta-icon">ğŸ¨</span>
            <span class="meta-label">THEME:</span>
            <span class="meta-value">{{ section.settings.theme | upcase }}</span>
          </div>
        {% endif %}

        {% if section.settings.product_count != blank %}
          <div class="meta-item">
            <span class="meta-icon">ğŸ“¦</span>
            <span class="meta-label">ITEMS:</span>
            <span class="meta-value">{{ section.settings.product_count }}</span>
          </div>
        {% endif %}

      </div>

      {%- comment -%} CTA Buttons {%- endcomment -%}
      <div class="featured-ctas">

        <a
          href="{{ section.settings.primary_cta_link | default: '#' }}"
          class="featured-cta featured-cta-primary"
        >
          {{ section.settings.primary_cta_text | default: 'EXPLORE CAPSULE' }}
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M5 10h10M10 5l5 5-5 5"/>
          </svg>
        </a>

        {% if section.settings.show_secondary_cta %}
          <a
            href="{{ section.settings.secondary_cta_link | default: '#' }}"
            class="featured-cta featured-cta-secondary"
          >
            {{ section.settings.secondary_cta_text | default: 'READ LORE' }}
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 10h10M10 5l5 5-5 5"/>
            </svg>
          </a>
        {% endif %}

      </div>

    </div>

  </div>

</section>

{% schema %}
{
  "name": "Featured Transmission",
  "tag": "section",
  "class": "section-featured-transmission",
  "settings": [
    {
      "type": "header",
      "content": "Featured Capsule"
    },
    {
      "type": "product",
      "id": "featured_product",
      "label": "Featured capsule product",
      "info": "Select a product to pull capsule data from. Leave empty to use manual settings below or first product from collection."
    },
    {
      "type": "text",
      "id": "collection_handle",
      "label": "Fallback collection handle",
      "default": "transmissions",
      "info": "Used if no product is selected. First product from this collection will be featured."
    },
    {
      "type": "text",
      "id": "capsule_number",
      "label": "Capsule number (manual override)",
      "default": "008",
      "info": "e.g., 001, 002, etc. Only used if no product selected."
    },
    {
      "type": "text",
      "id": "capsule_title",
      "label": "Capsule title",
      "default": "GLITCHWAVE ORACLE"
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "The latest transmission from the cosmic void"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Dive into the latest capsule featuring exclusive designs inspired by retro-futuristic aesthetics and analog mysticism.</p>"
    },
    {
      "type": "image_picker",
      "id": "capsule_tag_image",
      "label": "Capsule tag image",
      "info": "The designed capsule tag graphic (prioritized over featured image)"
    },
    {
      "type": "image_picker",
      "id": "featured_image",
      "label": "Featured image (fallback)"
    },
    {
      "type": "header",
      "content": "Lore Preview"
    },
    {
      "type": "textarea",
      "id": "lore_preview",
      "label": "Lore excerpt",
      "default": "In the depths of the digital cosmos, signals pulse through the voidâ€”fragments of forgotten futures and alternate timelines converging...",
      "info": "Short preview of the capsule's mythology"
    },
    {
      "type": "header",
      "content": "Metadata"
    },
    {
      "type": "text",
      "id": "release_date",
      "label": "Release date",
      "default": "2024.10"
    },
    {
      "type": "text",
      "id": "theme",
      "label": "Theme",
      "default": "Neon Magenta"
    },
    {
      "type": "text",
      "id": "product_count",
      "label": "Number of items",
      "default": "12"
    },
    {
      "type": "header",
      "content": "Call to Action"
    },
    {
      "type": "text",
      "id": "primary_cta_text",
      "label": "Primary button text",
      "default": "EXPLORE CAPSULE"
    },
    {
      "type": "url",
      "id": "primary_cta_link",
      "label": "Primary button link"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_cta",
      "label": "Show secondary button",
      "default": true
    },
    {
      "type": "text",
      "id": "secondary_cta_text",
      "label": "Secondary button text",
      "default": "READ LORE"
    },
    {
      "type": "url",
      "id": "secondary_cta_link",
      "label": "Secondary button link"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "image_position",
      "label": "Image position",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "default": 80
    }
  ],
  "presets": [
    {
      "name": "Featured Transmission"
    }
  ]
}
{% endschema %}

<style>
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FEATURED TRANSMISSION STYLES
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  .featured-transmission {
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;
    background: var(--void-black);
    position: relative;
    overflow: hidden;
  }

  .featured-transmission::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 30% 50%, rgba(225, 60, 250, 0.08) 0%, transparent 60%);
    pointer-events: none;
  }

  .featured-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    align-items: center;
  }

  /* Reverse layout if image on right */
  .featured-transmission[data-image-position="right"] .featured-container {
    grid-template-columns: 1fr 1fr;
  }

  .featured-transmission[data-image-position="right"] .featured-image-wrapper {
    order: 2;
  }

  /* Image Side */
  .featured-image-wrapper {
    position: relative;
  }

  .featured-image-container {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    border: 2px solid var(--cyan-blue);
    box-shadow: 0 0 40px rgba(40, 168, 214, 0.3);
    transition: all 0.4s ease;
  }

  .featured-image-container:hover {
    transform: translateY(-8px);
    box-shadow: 0 10px 60px rgba(40, 168, 214, 0.5);
    border-color: var(--neon-magenta);
  }

  .featured-image {
    width: 100%;
    height: auto;
    display: block;
    transition: transform 0.6s ease;
  }

  .featured-image-container:hover .featured-image {
    transform: scale(1.05);
  }

  .featured-image-glow {
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,
      transparent,
      rgba(40, 168, 214, 0.2),
      transparent);
    transition: left 0.8s ease;
    pointer-events: none;
  }

  .featured-image-container:hover .featured-image-glow {
    left: 100%;
  }

  /* Featured Badge */
  .featured-badge {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: linear-gradient(135deg, var(--neon-magenta), var(--cosmic-purple));
    border-radius: 30px;
    font-family: 'Orbitron', monospace;
    font-size: 0.8125rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    color: white;
    box-shadow: 0 0 20px var(--neon-magenta);
    animation: pulse-glow 2s ease-in-out infinite;
  }

  .badge-icon {
    font-size: 1rem;
  }

  /* Content Side */
  .featured-content {
    padding: 2rem 0;
  }

  .featured-tag {
    display: inline-block;
    font-size: 0.875rem;
    font-weight: 700;
    letter-spacing: 0.15em;
    color: var(--cyan-blue);
    padding: 0.75rem 1.5rem;
    background: rgba(40, 168, 214, 0.1);
    border: 2px solid var(--cyan-blue);
    border-radius: 30px;
    margin-bottom: 1.5rem;
  }

  .featured-title {
    font-size: clamp(2.5rem, 6vw, 4rem);
    font-weight: 900;
    line-height: 1.1;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, var(--neon-magenta), var(--cyan-blue));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 0 40px var(--neon-magenta);
  }

  .featured-subtitle {
    font-size: clamp(1.125rem, 2vw, 1.5rem);
    color: rgba(255, 255, 255, 0.8);
    margin-bottom: 2rem;
    line-height: 1.6;
  }

  .featured-description {
    color: rgba(255, 255, 255, 0.75);
    line-height: 1.8;
    margin-bottom: 2rem;
    font-size: 1.0625rem;
  }

  /* Lore Preview */
  .featured-lore {
    background: linear-gradient(135deg,
      rgba(225, 60, 250, 0.05),
      rgba(40, 168, 214, 0.05));
    border-left: 4px solid var(--electric-yellow);
    padding: 1.5rem;
    margin-bottom: 2rem;
    border-radius: 4px;
  }

  .lore-label {
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.15em;
    color: var(--electric-yellow);
    margin-bottom: 0.75rem;
  }

  .lore-text {
    color: rgba(255, 255, 255, 0.85);
    line-height: 1.7;
    font-style: italic;
  }

  /* Metadata */
  .featured-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 2rem;
    margin-bottom: 2.5rem;
    padding: 1.5rem;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(40, 168, 214, 0.2);
    border-radius: 8px;
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9375rem;
  }

  .meta-icon {
    font-size: 1.25rem;
  }

  .meta-label {
    font-family: 'Orbitron', monospace;
    font-weight: 600;
    color: var(--cyan-blue);
    font-size: 0.8125rem;
    letter-spacing: 0.05em;
  }

  .meta-value {
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
  }

  /* CTA Buttons */
  .featured-ctas {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
  }

  .featured-cta {
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1.25rem 2.5rem;
    font-size: 0.9375rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-decoration: none;
    text-transform: uppercase;
    font-family: 'Orbitron', monospace;
    border-radius: 6px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .featured-cta svg {
    transition: transform 0.3s ease;
  }

  .featured-cta:hover svg {
    transform: translateX(4px);
  }

  /* Primary CTA */
  .featured-cta-primary {
    background: var(--neon-magenta);
    color: var(--void-black);
    border: 2px solid var(--neon-magenta);
    box-shadow: 0 0 20px var(--neon-magenta);
  }

  .featured-cta-primary:hover {
    background: transparent;
    color: var(--neon-magenta);
    box-shadow: 0 0 40px var(--neon-magenta);
    transform: translateY(-2px);
  }

  /* Secondary CTA */
  .featured-cta-secondary {
    background: transparent;
    color: var(--cyan-blue);
    border: 2px solid var(--cyan-blue);
  }

  .featured-cta-secondary:hover {
    background: var(--cyan-blue);
    color: var(--void-black);
    box-shadow: 0 0 30px var(--cyan-blue);
    transform: translateY(-2px);
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .featured-container {
      gap: 3rem;
    }

    .featured-title {
      font-size: 2.5rem;
    }
  }

  @media (max-width: 768px) {
    .featured-transmission {
      padding: 3rem 0;
    }

    .featured-container {
      grid-template-columns: 1fr;
      gap: 2rem;
      padding: 0 1.5rem;
    }

    .featured-transmission[data-image-position="right"] .featured-image-wrapper {
      order: 0;
    }

    .featured-content {
      padding: 0;
    }

    .featured-title {
      font-size: 2rem;
    }

    .featured-meta {
      flex-direction: column;
      gap: 1rem;
    }

    .featured-ctas {
      flex-direction: column;
    }

    .featured-cta {
      width: 100%;
      justify-content: center;
      padding: 1rem 2rem;
    }

    .featured-badge {
      top: 1rem;
      right: 1rem;
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
    }
  }

  /* Accessibility */
  @media (prefers-reduced-motion: reduce) {
    .featured-image-container,
    .featured-image,
    .featured-image-glow,
    .featured-cta {
      transition: none;
      animation: none;
    }

    .featured-badge {
      animation: none;
    }
  }
</style>

<script>
  // Set image position
  (function() {
    const section = document.querySelector('.featured-transmission');
    if (!section) return;

    const imagePosition = '{{ section.settings.image_position }}';
    section.setAttribute('data-image-position', imagePosition);

    // Subtle parallax effect on scroll
    const imageContainer = section.querySelector('[data-parallax]');
    if (imageContainer && window.matchMedia('(prefers-reduced-motion: no-preference)').matches) {
      window.addEventListener('scroll', () => {
        const scrolled = window.pageYOffset;
        const rect = section.getBoundingClientRect();
        const sectionTop = rect.top + scrolled;
        const sectionHeight = rect.height;

        if (scrolled > sectionTop - window.innerHeight && scrolled < sectionTop + sectionHeight) {
          const parallaxAmount = (scrolled - (sectionTop - window.innerHeight)) * 0.15;
          imageContainer.style.transform = `translateY(${parallaxAmount}px)`;
        }
      });
    }

    // Track CTA clicks
    const ctas = section.querySelectorAll('.featured-cta');
    ctas.forEach(cta => {
      cta.addEventListener('click', function() {
        if (typeof window.stellarAnalytics !== 'undefined') {
          window.stellarAnalytics.trackCTAClick({
            section: 'featured_transmission',
            cta: this.textContent.trim(),
            destination: this.href
          });
        }
      });
    });
  })();
</script>
