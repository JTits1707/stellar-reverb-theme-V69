{% comment %}
Stellar Reverb ‚Äì Shop All Cosmic Grid
- Hero with collection meta
- Filter & sort toolbar
- Product grid with badges + capsule tags
- Limited relic strip + FOMO
- Signal Seeker CTA

Usage:
- Attach this section to your "Shop All" collection template
- Assumes product-card-cosmic snippet exists (same one used on capsule pages)
{% endcomment %}

<section
  class="shop-all-cosmic"
  style="padding-top: {{ section.settings.padding_top }}px; padding-bottom: {{ section.settings.padding_bottom }}px;"
  data-collection-handle="{{ collection.handle }}"
>

  <!-- Background (reuses your cosmic styles) -->
  <div class="cosmic-backdrop" aria-hidden="true">
    <div class="cosmic-gradient"></div>
    <div class="constellation-grid">
      <div class="constellation-dot" style="top:10%;left:10%;animation-delay:0s;"></div>
      <div class="constellation-dot" style="top:25%;left:80%;animation-delay:-1.5s;"></div>
      <div class="constellation-dot" style="top:60%;left:20%;animation-delay:-3s;"></div>
      <div class="constellation-dot" style="top:78%;left:65%;animation-delay:-2.2s;"></div>
      <div class="constellation-dot" style="top:45%;left:92%;animation-delay:-3.5s;"></div>
    </div>
  </div>

  <div class="container">

    {%- comment -%} HERO {%- endcomment -%}
    <header class="shop-all-hero">
      <div class="shop-all-meta">
        <span class="shop-label-pill">
          UNIVERSAL RELIC GRID
        </span>

        {% if section.settings.show_product_count %}
          <span class="shop-count">
            {{ collection.products_count }} relics decoded
          </span>
        {% endif %}
      </div>

      <h1 class="shop-all-title glitch-text" data-text="{{ section.settings.hero_title | default: collection.title }}">
        {{ section.settings.hero_title | default: collection.title }}
      </h1>

      {% if section.settings.hero_subtitle != blank %}
        <p class="shop-all-subtitle">
          {{ section.settings.hero_subtitle }}
        </p>
      {% elsif collection.description != blank %}
        <div class="shop-all-subtitle rte">
          {{ collection.description }}
        </div>
      {% endif %}
    </header>

    {%- comment -%} TOOLBAR: FILTERS + SORT {%- endcomment -%}
    <section class="shop-all-toolbar" aria-label="Filter and sort relics">
      <div class="toolbar-left">

        {%- if section.settings.enable_tag_filters and collection.all_tags.size > 0 -%}
          <div class="filter-chips" role="list">
            <button
              class="filter-chip{% if current_tags == blank %} is-active{% endif %}"
              type="button"
              data-filter-url="{{ collection.url }}"
            >
              All relics
            </button>

            {%- for tag in collection.all_tags -%}
              {%- assign tag_handle = tag | handleize -%}
              {%- assign tag_active = false -%}
              {%- if current_tags contains tag -%}{% assign tag_active = true %}{%- endif -%}

              <button
                class="filter-chip{% if tag_active %} is-active{% endif %}"
                type="button"
                data-filter-url="{{ collection.url }}/{{ tag_handle }}"
              >
                {{ tag }}
              </button>
            {%- endfor -%}
          </div>
        {%- endif -%}

      </div>

      <div class="toolbar-right">

        {%- if section.settings.show_sort -%}
          <form class="shop-all-sort" method="get">
            <label for="sort-by-{{ section.id }}" class="visually-hidden">
              {{ 'products.sorting.label' | t }}
            </label>
            <select
              id="sort-by-{{ section.id }}"
              name="sort_by"
              class="sort-select"
              aria-label="{{ 'products.sorting.label' | t }}"
            >
              {%- assign sort_by = collection.sort_by | default: collection.default_sort_by -%}
              {%- for option in collection.sort_options -%}
                <option value="{{ option.value }}" {% if option.value == sort_by %}selected{% endif %}>
                  {{ option.name }}
                </option>
              {%- endfor -%}
            </select>
          </form>
        {%- endif -%}

      </div>
    </section>

    {%- comment -%} MAIN GRID {%- endcomment -%}
    {% paginate collection.products by section.settings.products_per_page %}
      {% if collection.products_count > 0 %}
        <section class="shop-all-grid" aria-label="Relic grid">
          <div class="shop-all-grid-inner">
            {% for product in collection.products %}
              <article
                class="shop-all-product-card"
                role="listitem"
                data-product-id="{{ product.id }}"
                data-product-handle="{{ product.handle }}"
              >
                {% render 'product-card-cosmic',
                  product: product,
                  capsule_number: product.metafields.custom.capsule_number,
                  low_stock_threshold: section.settings.low_stock_threshold,
                  show_total_low_stock: section.settings.show_total_low_stock
                %}
              </article>
            {% endfor %}
          </div>

          {% if paginate.pages > 1 %}
            <nav class="shop-all-pagination" role="navigation" aria-label="Pagination">
              {% if paginate.previous %}
                <a href="{{ paginate.previous.url }}" class="page-link prev">Prev</a>
              {% endif %}
              <span class="page-status">
                Page {{ paginate.current_page }} of {{ paginate.pages }}
              </span>
              {% if paginate.next %}
                <a href="{{ paginate.next.url }}" class="page-link next">Next</a>
              {% endif %}
            </nav>
          {% endif %}
        </section>
      {% else %}
        <div class="empty-state">
          <div class="empty-icon" aria-hidden="true">üì°</div>
          <p class="empty-message">No relics are live here yet. Tune back in soon.</p>
        </div>
      {% endif %}
    {% endpaginate %}

    {%- comment -%} LIMITED RELICS STRIP (FOMO) {%- endcomment -%}
    {% if section.settings.show_limited_strip %}
      {% assign limited_count = 0 %}
      <section class="limited-strip" aria-label="Almost gone relics">
        <div class="limited-strip-inner">
          <div class="limited-strip-header">
            <span class="limited-pill">Almost gone</span>
            <p class="limited-copy">
              Final waves from the archive. Once they‚Äôre gone, the signal never returns.
            </p>
          </div>

          <div class="limited-strip-grid">
            {% for product in collection.products %}
              {% if product.total_inventory > 0 and product.total_inventory <= section.settings.low_stock_threshold %}
                {% assign limited_count = limited_count | plus: 1 %}
                <a href="{{ product.url }}" class="limited-item">
                  {% if product.featured_image %}
                    <div class="limited-thumb">
                      {{ product.featured_image | image_url: width: 400 | image_tag: loading: 'lazy', alt: product.title }}
                    </div>
                  {% endif %}
                  <div class="limited-meta">
                    <h3 class="limited-title">{{ product.title }}</h3>
                    <p class="limited-stock">
                      {{ product.total_inventory }} left in the vault
                    </p>
                  </div>
                </a>
              {% endif %}
              {% if limited_count >= section.settings.max_limited_items %}
                {% break %}
              {% endif %}
            {% endfor %}

            {% if limited_count == 0 %}
              <p class="limited-empty">
                No relics are in critical range right now. The archive is stable‚Ä¶ for the moment.
              </p>
            {% endif %}
          </div>
        </div>
      </section>
    {% endif %}

    {%- comment -%} SIGNAL SEEKER CTA (reuses your brand pattern) {%- endcomment -%}
    {% if section.settings.show_signal_cta %}
      <aside class="signal-cta-compact" aria-labelledby="signal-cta-title">
        <div class="signal-inner">
          <h2 id="signal-cta-title" class="signal-title">
            Stay Ahead of the Next Transmission
          </h2>
          <p class="signal-subtitle">
            Join the Signal Seekers list for early capsule access, hidden drops, and floating archive relics.
          </p>
          <a href="/pages/signal-seekers" class="signal-btn">
            <span>Join the Frequency</span>
            <span aria-hidden="true">üì°</span>
          </a>
        </div>
      </aside>
    {% endif %}

  </div>

</section>

<script>
(function() {
  // Tag filter buttons ‚Üí navigate to URL in data-filter-url
  document.querySelectorAll('.shop-all-cosmic .filter-chip').forEach(function(btn) {
    btn.addEventListener('click', function() {
      var url = btn.getAttribute('data-filter-url');
      if (url) {
        window.location.href = url;
      }
    });
  });

  // Sort select auto-submit
  var sortForm = document.querySelector('.shop-all-sort');
  if (sortForm) {
    var select = sortForm.querySelector('.sort-select');
    select && select.addEventListener('change', function() {
      sortForm.submit();
    });
  }
})();
</script>

{% schema %}
{
  "name": "Shop All ‚Äî Cosmic Grid",
  "settings": [
    {
      "type": "text",
      "id": "hero_title",
      "label": "Hero title",
      "default": "Shop All Relics"
    },
    {
      "type": "textarea",
      "id": "hero_subtitle",
      "label": "Hero subtitle",
      "default": "Every signal we‚Äôve decoded from the Stellar Reverb archive ‚Äî capsules, floating relics, and limited signals."
    },
    {
      "type": "checkbox",
      "id": "show_product_count",
      "label": "Show product count",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_tag_filters",
      "label": "Show tag filter chips",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_sort",
      "label": "Show sort dropdown",
      "default": true
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products per page",
      "min": 8,
      "max": 48,
      "step": 4,
      "default": 24
    },
    {
      "type": "header",
      "content": "‚ö†Ô∏è Limited relic strip"
    },
    {
      "type": "checkbox",
      "id": "show_limited_strip",
      "label": "Show 'Almost gone' strip",
      "default": true
    },
    {
      "type": "range",
      "id": "low_stock_threshold",
      "label": "Low-stock threshold",
      "min": 1,
      "max": 25,
      "step": 1,
      "default": 5
    },
    {
      "type": "range",
      "id": "max_limited_items",
      "label": "Max limited relics to show",
      "min": 1,
      "max": 12,
      "step": 1,
      "default": 6
    },
    {
      "type": "checkbox",
      "id": "show_total_low_stock",
      "label": "Pass low-stock settings into product card snippet",
      "default": true
    },
    {
      "type": "header",
      "content": "üì° Signal Seeker CTA"
    },
    {
      "type": "checkbox",
      "id": "show_signal_cta",
      "label": "Show Signal Seeker CTA",
      "default": true
    },
    {
      "type": "header",
      "content": "‚öôÔ∏è Section spacing"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 160,
      "step": 8,
      "unit": "px",
      "label": "Top padding",
      "default": 80
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 160,
      "step": 8,
      "unit": "px",
      "label": "Bottom padding",
      "default": 80
    }
  ],
  "presets": [
    {
      "name": "Shop All ‚Äî Cosmic Grid",
      "category": "Stellar Reverb"
    }
  ]
}
{% endschema %}