{% assign all_capsules = metaobjects.capsule.values %}

{% assign prime_capsules      = all_capsules | where: 'timeline_track', 'prime'      | sort: 'timeline_order' %}
{% assign lunar_capsules      = all_capsules | where: 'timeline_track', 'lunar'      | sort: 'timeline_order' %}
{% assign singularity_capsules= all_capsules | where: 'timeline_track', 'singularity'| sort: 'timeline_order' %}
{% assign hidden_capsules     = all_capsules | where: 'timeline_track', 'hidden'     | sort: 'timeline_order' %}{% comment %}
UNIVERSAL LORE – SIGNAL SIGNUP
Email capture for Signal Seekers.

Hooks for universal-lore.js:
- #signalForm
- .signup-content
- #formStatus
- button[type="submit"] with .submit-text and .submit-loading spans
- data-service / data-list-id for external providers (optional)
{% endcomment %}

<section class="universal-lore-signup" data-section-type="lore-signup">
  <div class="signup-inner container signup-content">
    <header class="signup-header">
      <p class="signup-kicker orbitron">
        {{ section.settings.kicker | default: 'SIGNAL SEEKER REGISTRY' }}
      </p>
      <h2 class="signup-title orbitron">
        {{ section.settings.heading | default: 'Get The Next Transmission Before It Drops' }}
      </h2>
      <p class="signup-subtitle">
        {{ section.settings.subheading | default: "No spam. No filler. Just capsule drops, lore fragments, and early-access relics when the signal hits." }}
      </p>
    </header>

    <form
      id="signalForm"
      class="signup-form shopify-form"
      method="post"
      novalidate
      {% if section.settings.service != blank %}
        data-service="{{ section.settings.service }}"
      {% endif %}
      {% if section.settings.list_id != blank %}
        data-list-id="{{ section.settings.list_id }}"
      {% endif %}
    >
      <div class="signup-fields">
        <label for="signalEmail" class="signup-label">
          {{ section.settings.email_label | default: 'Email address' }}
        </label>
        <div class="signup-input-row">
          <input
            id="signalEmail"
            type="email"
            name="email"
            class="signup-input"
            placeholder="{{ section.settings.email_placeholder | default: 'you@yourfrequency.com' }}"
            required
          >
          <button type="submit" class="btn signup-submit">
            <span class="submit-text">
              {{ section.settings.button_label | default: 'Join the Signal' }}
            </span>
            <span class="submit-loading" style="display:none;">
              {{ section.settings.loading_label | default: 'Connecting…' }}
            </span>
          </button>
        </div>
      </div>

      <p id="formStatus" class="form-status" aria-live="polite"></p>

      {%- if section.settings.legal_copy != blank -%}
        <p class="signup-legal">
          {{ section.settings.legal_copy }}
        </p>
      {%- endif -%}
    </form>
  </div>
</section>

{% schema %}
{
  "name": "Universal Lore Signup",
  "tag": "section",
  "class": "section-universal-lore-signup",
  "settings": [
    {
      "type": "text",
      "id": "kicker",
      "label": "Kicker",
      "default": "SIGNAL SEEKER REGISTRY"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": ""
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": ""
    },
    {
      "type": "text",
      "id": "email_label",
      "label": "Email label",
      "default": "Email address"
    },
    {
      "type": "text",
      "id": "email_placeholder",
      "label": "Email placeholder",
      "default": "you@yourfrequency.com"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button label",
      "default": "Join the Signal"
    },
    {
      "type": "text",
      "id": "loading_label",
      "label": "Loading label",
      "default": "Connecting…"
    },
    {
      "type": "textarea",
      "id": "legal_copy",
      "label": "Legal / reassurance copy",
      "default": ""
    },
    {
      "type": "select",
      "id": "service",
      "label": "Email service",
      "default": "shopify",
      "options": [
        { "value": "shopify", "label": "Shopify (native or proxy)" },
        { "value": "mailchimp", "label": "Mailchimp" },
        { "value": "klaviyo", "label": "Klaviyo" },
        { "value": "custom", "label": "Custom endpoint" }
      ]
    },
    {
      "type": "text",
      "id": "list_id",
      "label": "List / audience ID (optional)",
      "default": ""
    }
  ],
  "blocks": [],
  "presets": [
    {
      "name": "Universal Lore Signup",
      "category": "Stellar Reverb"
    }
  ]
}
{% endschema %}