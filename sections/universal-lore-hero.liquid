{% comment %}
UNIVERSAL LORE HERO
Powered by capsule metaobjects + multi-track system.

- Highlights the "spotlight" capsule:
  • Prefer: prime + live, highest timeline_order
  • Fallback: first capsule in metaobjects.capsule.values

- Hooks for universal-lore.js:
  • data-section-type="lore-hero"
  • .hero-title, .hero-subtitle, .hero-description, .cta-primary
  • #enterVoid button → scrolls to #timeline
{% endcomment %}

<section class="lore-hero universal-lore-hero" data-section-type="lore-hero">
  {%- assign all_capsules = metaobjects.capsule.values -%}

  {%- assign prime_live = all_capsules
    | where: 'timeline_track', 'prime'
    | where: 'signal_state', 'live'
    | sort: 'timeline_order'
  -%}

  {%- if prime_live.size > 0 -%}
    {%- assign spotlight = prime_live | last -%}
  {%- else -%}
    {%- assign spotlight = all_capsules | first -%}
  {%- endif -%}

  <div class="lore-hero-inner container">
    <div class="lore-hero-content">
      {%- if spotlight.capsule_number != blank -%}
        <p class="hero-kicker orbitron">
          Transmission {{ spotlight.capsule_number }}
        </p>
      {%- elsif section.settings.kicker_text != blank -%}
        <p class="hero-kicker orbitron">
          {{ section.settings.kicker_text }}
        </p>
      {%- endif -%}

      <h1 class="hero-title orbitron">
        {%- if section.settings.heading_override != blank -%}
          {{ section.settings.heading_override }}
        {%- elsif spotlight.capsule_title != blank -%}
          {{ spotlight.capsule_title }}
        {%- else -%}
          Universal Lore Index
        {%- endif -%}
      </h1>

      <p class="hero-subtitle">
        {%- if section.settings.subheading_override != blank -%}
          {{ section.settings.subheading_override }}
        {%- else -%}
          From the first distortion at the event horizon to the last echo in the archives —
          this is the master signal log of every Stellar Reverb transmission.
        {%- endif -%}
      </p>

      <p class="hero-description">
        {%- if spotlight.capsule_lore_short != blank -%}
          {{ spotlight.capsule_lore_short }}
        {%- elsif spotlight.capsule_lore_extended != blank -%}
          {{ spotlight.capsule_lore_extended | strip_html | truncate: 260 }}
        {%- else -%}
          Every capsule is a fragment of a larger myth — stitched from sound, tape, and cosmic ruin.
          Scroll to the timeline to trace the fractures in reality, or dive straight into the active transmission.
        {%- endif -%}
      </p>

      <div class="hero-ctas">
        <button
          id="enterVoid"
          type="button"
          class="cta-primary btn hero-cta-main"
        >
          <span class="submit-text">
            {{ section.settings.primary_cta_label | default: 'Enter the Timeline' }}
          </span>
        </button>

        {%- assign spotlight_collection_handle = spotlight.collection_handle -%}
        {%- if spotlight_collection_handle != blank -%}
          <a
            href="/collections/{{ spotlight_collection_handle }}"
            class="cta-secondary btn-outline hero-cta-secondary"
          >
            {{ section.settings.secondary_cta_label | default: 'Explore This Transmission' }}
          </a>
        {%- elsif section.settings.fallback_secondary_url != blank -%}
          <a
            href="{{ section.settings.fallback_secondary_url }}"
            class="cta-secondary btn-outline hero-cta-secondary"
          >
            {{ section.settings.secondary_cta_label | default: 'Explore the Relic Vault' }}
          </a>
        {%- endif -%}
      </div>

      {%- if section.settings.show_hero_meta and spotlight.capsule_slug != blank -%}
        <div class="hero-meta">
          <span class="meta-item">
            <span class="label">Capsule:</span>
            <span class="value">{{ spotlight.capsule_number }} · {{ spotlight.capsule_title }}</span>
          </span>
          {%- if spotlight.timeline_track != blank -%}
            <span class="meta-item">
              <span class="label">Track:</span>
              <span class="value">
                {%- case spotlight.timeline_track -%}
                  {%- when 'prime' -%}Prime Timeline
                  {%- when 'lunar' -%}Lunar Archives
                  {%- when 'singularity' -%}Singularity Lineage
                  {%- when 'hidden' -%}Hidden Signals
                  {%- else -%}{{ spotlight.timeline_track | capitalize }}
                {%- endcase -%}
              </span>
            </span>
          {%- endif -%}
        </div>
      {%- endif -%}
    </div>

    <div class="lore-hero-visual">
      {%- assign hero_image = spotlight.hero_image_main -%}
      {%- if hero_image == blank and section.settings.fallback_hero_image != blank -%}
        {%- assign hero_image = section.settings.fallback_hero_image -%}
      {%- endif -%}

      {%- if hero_image != blank -%}
        <div class="hero-image-frame">
          <img
            src="{{ hero_image | image_url: width: 1200 }}"
            srcset="
              {{ hero_image | image_url: width: 600 }} 600w,
              {{ hero_image | image_url: width: 900 }} 900w,
              {{ hero_image | image_url: width: 1200 }} 1200w
            "
            sizes="(min-width: 1024px) 50vw, 100vw"
            alt="{{ spotlight.capsule_title | default: section.settings.heading_override | escape }}"
            loading="lazy"
            class="hero-image"
          >
          <div class="hero-image-overlay"></div>
        </div>
      {%- else -%}
        <div class="hero-placeholder">
          <span class="orbitron">Stellar Reverb · Universal Lore</span>
          <span class="hero-placeholder-line">Visual transmission pending…</span>
        </div>
      {%- endif -%}
    </div>
  </div>
</section>

{% schema %}
{
"type": "universal-lore-hero",
```
  "tag": "section",
  "class": "section-universal-lore-hero",
  "settings": [
    {
      "type": "text",
      "id": "kicker_text",
      "label": "Kicker text",
      "default": "UNIVERSAL LORE ARCHIVE"
    },
    {
      "type": "text",
      "id": "heading_override",
      "label": "Heading override",
      "default": ""
    },
    {
      "type": "textarea",
      "id": "subheading_override",
      "label": "Subheading override",
      "default": ""
    },
    {
      "type": "image_picker",
      "id": "fallback_hero_image",
      "label": "Fallback hero image"
    },
    {
      "type": "text",
      "id": "primary_cta_label",
      "label": "Primary CTA label",
      "default": "Enter the Timeline"
    },
    {
      "type": "text",
      "id": "secondary_cta_label",
      "label": "Secondary CTA label",
      "default": "Explore This Transmission"
    },
    {
      "type": "url",
      "id": "fallback_secondary_url",
      "label": "Fallback secondary CTA URL",
      "info": "Used if the spotlight capsule does not have a collection_handle."
    },
    {
      "type": "checkbox",
      "id": "show_hero_meta",
      "label": "Show capsule meta (track, number)",
      "default": true
    }
  ],
  "blocks": [],
  "presets": [
    {
      "name": "Universal Lore Hero",
      "category": "Stellar Reverb"
    }
  ]
}
{% endschema %}